<pre class="ruby">
#!/usr/bin/ruby1.8
=begin
File:      notdig.fcgi
Copyright: Savonix Corporation
Author:    Albert Lash
License:   MIT
=end

require 'fcgi'
require 'dbm'

myfile = "/var/tmp/recent_queries"
rq = DBM.open(myfile)

FCGI.each_cgi {|cgi|

    puts cgi.header("text/plain")
    cmd = cgi["host"]
    if cmd =~ /[^a-z0-9-\.]+/
        puts 'error'
    else
        rq[cmd] = Time.now.to_i
        res = `dig #{cmd}`
        #puts rq[cmd]
        puts res
    end

    #hostlist = rq.keys().sort()
    #hostlist.each { |host|
    #    puts "#{host}\t#{rq[host]}\n"
    #}
}
</pre>

### Related Pages
* [[Ruby]]
* [[FastCGI]]

