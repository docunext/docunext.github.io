{"data":{"markdownRemark":{"html":"<p>I'm setting up Ipsec on ubuntu:</p>\n<pre>apt-get install racoon</pre>\n<p>ran into problems:</p>\n<pre>Reading package lists... Done\nBuilding dependency tree... Done\nThe following NEW packages will be installed:  racoon\n0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 342kB of archives.\nAfter unpacking 1053kB of additional disk space will be used.\nGet:1 http://archive.ubuntu.com dapper/main racoon 1:0.6.5-4ubuntu1 [342kB]\nFetched 342kB in 1s (238kB/s)\nPreconfiguring packages ...\nSelecting previously deselected package racoon.(Reading database ... 17951 files and directories currently installed.)\nUnpacking racoon (from .../racoon_1%3a0.6.5-4ubuntu1_amd64.deb) ...\nSetting up racoon (0.6.5-4ubuntu1) ...\nGenerating /etc/default/racoon...\nLoading IPSEC/crypto modules...\ninsmod: error inserting '/lib/modules/2.6.16.29-xen/kernel/crypto/crc32c.ko': -1 Unknown symbol in module\ninsmod: error inserting '/lib/modules/2.6.16.29-xen/kernel/net/ipv6/ipcomp6.ko': -1 Unknown symbol in module\nIPSEC/crypto modules loaded.\nStarting IKE (ISAKMP/Oakley) server: racoon: failed to parse configuration file.\nracoon-tool: racoon did not start.\ninvoke-rc.d: initscript racoon, action \"start\" failed.\ndpkg: error processing racoon (--configure): subprocess post-installation script returned error exit status 255\nErrors were encountered while processing: racoon\nE: Sub-process /usr/bin/dpkg returned an error code (1)</pre>\n<pre>apt-get remove racoon</pre>\n<pre>modprobe crc32c\nmodprobe ipcomp6</pre>\n<pre>apt-get install racoon</pre>\n<p>same thing, maybe the errors are OK?</p>\n<p>This the problem from syslog?</p>\n<pre>racoon: ERROR: glob found no matches for path</pre>\n<p>This page translated:</p>\n<p><a href=\"http://translate.google.com/translate?hl=en&amp;sl=de&amp;u=http://www.ubuntu-forum.de/artikel/3416/Breezy--IPSec-Tools.html&amp;sa=X&amp;oi=translate&amp;resnum=5&amp;ct=result&amp;prev=/search%3Fq%3Dracoon:%2BERROR:%2Bglob%2Bfound%2Bno%2Bmatches%2Bfor%2Bpath%26hl%3Den\">Breezy + IPSec Tools</a></p>\n<p>suggests loading:</p>\n<pre>modprobe xfrm6_tunnel</pre>\n<p>and it worked!</p>\n<pre>/etc/init.d/racoon start\nLoading IPSEC/crypto modules...\nIPSEC/crypto modules loaded.\nStarting IKE (ISAKMP/Oakley) server: racoon: failed to parse configuration file.\nracoon.\nFlushing SAD and SPD...\nSAD and SPD flushed.\nLoading SAD and SPD...\nSAD and SPD loaded.\nConfiguring racoon...done.</pre>\n<p>Still not working, now getting this error in syslog:</p>\n<pre>racoon: ERROR: couldn't find configuration. </pre>\n<p>increasing verbosity:</p>\n<pre>get pfkey X_SPDDUMP message\npfkey X_SPDDUMP failed: No such file or directory</pre>\n<p>Hmmm, what is pfkey - restarted setkey and its good, then had some mismatched encryption settings. Now this:</p>\n<pre>racoon: ERROR: couldn't find the pskey</pre>\n<p>Hmmm. Got that working  - you really have to make sure all the setting match up on both side. The sa gets established, but I can't ping one box from the other. Though packets are getting through (as seen via tcpdump). The issue now must be something to do with iptables, routing, or something similar.</p>\n<p>Argh. I just couldn't get this working, but I did learn a lot about ipsec on ubuntu / debian. I need to test it out on another server to make sure the problems I was having aren't isolated.</p>\n<p>IPSec Related links:</p>\n<ul>\n<li><a href=\"http://www.docunext.com/wiki/IPSec\">IPSec Docunext Wiki Page</a></li>\n<li><a href=\"http://www.ipsec-howto.org/t1.html\">http://www.ipsec-howto.org/t1.html</a></li>\n<li><a href=\"http://foodfight.org/log/Interweb/ipsec-1\">http://foodfight.org/log/Interweb/ipsec-1</a></li>\n</ul>","frontmatter":{"title":"Ubuntu IPSec","date":"March 25th, 2007"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2007/2007-03-25-ubuntu-ipsec/"}}