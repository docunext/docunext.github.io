{"data":{"markdownRemark":{"html":"<p>I'm building a more recent version of NGINX to take advantage of its xsl module, and while I'm at it I'm customizing the gcc flags, since the installation target is embedded, low-power systems, where every little bit counts!</p>\n<p>The usual:</p>\n<pre>\napt-get source nginx</pre>\n<p>Then I downloaded the source from the internet manually, copied over the debian/ directory, changed a few version numbers, and then did some internal adjusting:</p>\n<pre>\nvim auto/cc/gcc</pre>\n<p>I added these:</p>\n<pre>\nNGX_GCC_OPT=\"-Os\"\n\nCPU_OPT=\"-march=geode\"</pre><del>I also added \"-mtune=geode\" to the debian/rules file</del>. In the case that I use a machine with an intel atom (i686 or the like) or a via c7[1] (-march=i686 -mmmx -msse -msse2 -msse3), I would obviously change the -march flag. [<a href=\"http://gcc.gnu.org/onlinedocs/gcc/i386-and-x86_002d64-Options.html\">2</a>]\n<p>I also removed the ssl module from the configure line in debian/rules as I want to use pound as an ssl proxy - it can use specific openssl engines, as described <a href=\"http://www.docunext.com/wiki/Via_Padlock_OCF-Linux_Integration\">here</a>[<a href=\"http://www.docunext.com/wiki/Via_Padlock_OCF-Linux_Integration\">3</a>]. I also removed the flv module.</p>\n<p>Example resulting command:</p>\n<pre>\ngcc -c -Os -pipe -march=geode -Os -W -Wall -Wpointer-arith -Wno-unused-parameter -Wno-unused-function -Wunused-variable -Wunused-value -Werror -g -mtune=geode -I src/core -I src/event -I src/event/modules -I src/os/unix -I /usr/include/libxml2 -I objs \\\t\t-o objs/src/os/unix/ngx_user.o \\\t\tsrc/os/unix/ngx_user.c</pre>\n<p>References:</p>\n<ol>\n<li>\n<p><a href=\"http://en.gentoo-wiki.com/wiki/Safe_Cflags\">http://en.gentoo-wiki.com/wiki/Safe_Cflags</a></p>\n</li>\n<li>\n<p><a href=\"http://gcc.gnu.org/onlinedocs/gcc/i386-and-x86_002d64-Options.html\">http://gcc.gnu.org/onlinedocs/gcc/i386-and-x86_002d64-Options.html</a></p>\n</li>\n<li>\n<p><a href=\"http://www.docunext.com/wiki/Via_Padlock_OCF-Linux_Integration\">Via Padlock OCF-Linux Integration</a></p>\n</li>\n</ol>","frontmatter":{"title":"Customizing NGINX Debian Build","date":"February 4th, 2009"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2009/02/customizing-nginx-debian-build/"}}