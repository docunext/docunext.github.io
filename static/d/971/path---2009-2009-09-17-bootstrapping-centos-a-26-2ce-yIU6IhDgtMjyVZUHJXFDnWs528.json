{"data":{"markdownRemark":{"html":"<p>I'm following Lucas Nussbaum's notes on <a href=\"http://www.lucas-nussbaum.net/blog/?p=385\">bootstrapping a CentOS system on Debian</a>.</p>\n<p>I am using /var/tmp instead of /tmp, and I'm planning on using this as an OpenVZ container.</p>\n<p>My abridged procedure:</p>\n<pre class=\"sh_sh\">\napt-get install yum rpm python-m2crypto\napt-get install -t experimental rpm\nmkdir -p /var/tmp/centos/var/lib/rpm\nrpm --root /var/tmp/centos --initdb\n# http://rpm.pbone.net/index.php3/stat/4/idpl/12379189/com/centos-release-5-3.el5.centos.1.i386.rpm.html\nwget ftp://ftp.muug.mb.ca/mirror/centos/5.3/os/i386/CentOS/centos-release-5-3.el5.centos.1.i386.rpm\nrpm -ivh --force-debian --nodeps --root /tmp/centos centos-release*rpm\nyum --installroot /var/tmp/centos/ install yum\nln -s /var/tmp/centos/etc/pki /etc/pki\nyum --installroot /var/tmp/centos/ install yum\nmount -t proc foo /var/tmp/centos/proc\nmount -t sysfs foo /var/tmp/centos/sys\nchroot /var/tmp/centos /bin/bash --login\ncd /var/lib/rpm && rm *\necho \"nameserver 4.2.2.1\" &gt; /etc/resolv.conf\nrpm --initdb\nyum install yum\nyum install vim-minimal less\nyum clean all\nexit\n</pre>\n<p>After that, I followed the instructions on the <a href=\"http://wiki.openvz.org/Creating_a_CentOS_5.0_Template\">OpenVZ wiki for creating a CentOS 5 template</a>.</p>\n<p>With my own manual version of localepurge (and worse) thrown in for good measure.</p>\n<pre class=\"sh_sh\">\ncd /var/tmp/centos\numount proc/\numount sys/\ncd usr/lib\nmkdir locale_keep\nmv locale/en_US* locale_keep\nrm -rf locale/\nmv locale_keep locale\ncd ../share\nmkdir locale_keep\nmv locale/en_US locale_keep/\nrm -rf locale\nmv locale_keep locale\nrm info/*\nrm -rf man/*\nrm -rf doc/*\ncd ..\ncat etc/rc.sysinit | sed \"s/\\/sbin\\/start_udev/#\\/sbin\\/start_udev/\" > /tmp/rc.sysinit && mv /tmp/rc.sysinit etc/rc.sysinit\nmknod dev/ptmx c 5 2\nmkdir dev/pts\n/sbin/MAKEDEV -d dev ttyp ptyp\nmknod dev/null c 1 3\nmknod -m 644 dev/random c 1 8\nmknod dev/urandom c 1 9\ntar -czvf /vz/template/cache/centos-5.3-i386-minimal.tar.gz ./\n</pre>\n<p>I'll probably add some of the procedures I developed from mindeb to this process, like clearing out unused locales.</p>\n<p>That produces a 120MB container, and a 40MB compressed template cache. It could get smaller.</p>\n<p>I love this type of stuff! I'm definitely going to add this as a build target for <a href=\"http://www.nodows.com/blog/\">NODOWS</a>!</p>\n<p>If I mess up in this process, I do this:</p>\n<pre>\nrm /vz/template/cache/centos-5.3-i386-minimal.tar.gz\ntar -czvf /vz/template/cache/centos-5.3-i386-minimal.tar.gz ./\n</pre>\n<p>NOTE: I still can't get this working right. Seems to be a problem with udev and ptys.</p>\n<p>UPDATE: Thanks to some follow-up comments on the original post by Lucas, I learned about <a href=\"http://packages.debian.org/squeeze/mach\">mach</a>. Time to give that a try.</p>","frontmatter":{"title":"Bootstrapping CentOS"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2009/2009-09-17-bootstrapping-centos/"}}