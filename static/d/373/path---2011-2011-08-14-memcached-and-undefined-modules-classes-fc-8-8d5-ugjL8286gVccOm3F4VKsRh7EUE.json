{"data":{"markdownRemark":{"html":"<p>I ran into this sort-of bug while using Memcached and Rails. By caching an object in memcache, Rails doesn't know how to autoload the file that defines its class and throws an Undefined Module / Class error.</p>\n<p>Thankfully <a href=\"http://www.philsergi.com/2007/06/rails-memcached-undefinded-classmodule.html\">Phil</a> posted a helpful solution to this, and my variation of it is this:</p>\n<pre class=\"sh_ruby\">\n  1 class ApplicationController < ActionController::Base\n  2   protect_from_forgery\n  3   before_filter :preload_modules\n  4\n  5   def preload_modules\n  6     unless Rails.env.production?\n  7       load \"#{Rails.root}/app/models/accounts/account_base.rb\"\n  8       load \"#{Rails.root}/app/models/accounts/account.rb\"\n  9       [ \"app/models/accounts\" ].each do |path|\n 10         Dir[\"{Rails.root}/{path}/*.rb\"].each do |file|\n 11           load file\n 12         end\n 13       end\n 14       Account\n 15       Asset\n 16       Liability\n 17       Expense\n 18       Revenue\n 19       Other\n 20       Equity\n 21       BankAccount\n 22       CreditCard\n 23       Company\n 24       Customer\n 25       Vendor\n 26       CurrentAsset\n 27     end\n 28   end\n 29 end\n</pre>\n<p>Cool, huh? This is from <a href=\"http://www.regdel.com/\">Regdel, the open source bookkeeping app powered by Ruby and Ruby on Rails</a>.</p>\n<p>The code doesn't get evaluated in production because at this point I'm only caching objects that get reloaded when the classes are not cached. In the future, I might cache additional objects, but I don't know if I'll need to include the above, because again, the classes will get cached, and won't need to be autoloaded everytime.</p>\n<p><strong>UPDATE</strong>: I have confirmed that this is not necessary on production for my setup. I plan to research the use of memcache and Rails 3.1 more in the near future.</p>","frontmatter":{"title":"Memcached and Undefined Modules Classes","date":"August 14th, 2011"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2011/2011-08-14-memcached-and-undefined-modules-classes/"}}