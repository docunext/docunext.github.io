{"data":{"markdownRemark":{"html":"<p>( I don't recommend using this information, it is here for archival purposes only! )</p>\n<h3>\n<b>Installation of Gentoo on the epic Realm Server\n</b>\n</h3>\n<b>\n</b>Spent approximately 14 hours getting this all setup\n<ol>\n<li>Started with Gentoo minimal livecd\n</li>\n<li>boot options: gentoo doscsi noapic\n</li>\n<li>it had a cd rom removed from it?\n</li>\n<li>rmmod eth1394\n</li>\n<li>modprobe eepro100\n</li>\n<li>net-setup eth0 - dns: 63.240.76.19\n</li>\n<li>passwd\n</li>\n<li>/etc/init.d/sshd start\n</li>\n<li>4 partitions: /dev/sda1 - /boot ext2 64MB, /dev/sda2 - swap 512MB, /dev/sda2 / ext3, /dev/sdb1 /storage ext3\n</li>\n<li>chose gs-sources - Gentoo Stable\n</li>\n<li>When configuring kernel, set eepro100, scsi support, and cdrom support. what about the other devices?\n</li>\n<li>kept on getting an annoying error about /dev/rtc /dev/misc/rtc          * mknod /dev/misc/rtc c 10 135                o mknod /dev/rtc c 10 135                o nano /etc/modules.d/i386: alias char-major-10-135 off                o modules-update\n</li>\n<li>Even though I turned on Character Devices-&gt; Enhanced rtc in the kernel config and re-compiled.\n</li>\n<li>Decided to try reiserfs\n</li>\n<li>Added kernel support\n</li>\n<li>Didn't do anything\n</li>\n<li>cd /usr/src/linux\n</li>\n<li>make mrproper\n</li>\n<li>make menuconfig - loaded old config from /boot/\n</li>\n<li>set rtc, reiserfs support\n</li>\n<li>make dep &amp;&amp; make clean bzImage\n</li>\n<li>cp arch.... (from Gentoo instructions - copy over)\n</li>\n<li>fixed modules.d/i386 (changed off to rtc)\n</li>\n<li>reboot\n</li>\n<li>yeah\n</li>\n<li>emerge iozone\n</li>\n<li>emerge mysql\n</li>\n<li>emerge apache\n</li>\n<li>emerge curl\n</li>\n<li>curl php_build\n</li>\n<li>emerge sudo\n</li>\n</ol>Gentoo Kernel Config with epic realm server\n<p><strong>Side notes:</strong></p>\n<ul>\n<li>Excellent terminology in their docs: steps, choices, default, optional, warnings, notes, important\n</li>\n<li>tar has a p option to preserve permissions!\n</li>\n</ul>\n<p><strong>Edits to directions:</strong></p>\n<ul>\n<li>Don't emerge iozone, mysql, apache, curl or sudo\n</li>\n<li>Remove boot option from grub.conf\n</li>\n<li>Install all the software manually using scripts, change the php script to /usr/local, write script for apache.\n</li>\n<li>Print out David Lechnyer's instructions for mysql, apache, and mod_ssl\n</li>\n</ul>\n<p><strong>MySQL</strong></p>\n<ul>\n<li>Followed instructions from David L.'s howto\n</li>\n<li>/usr/bin/mysql_install_db\n</li>\n<li>forums.devarticles.com/archive/t-4635\n</li>\n<li>ERROR 2002: Can't connect to local MySQL server through socket '/var/lib/mysql/mysql. - this was because mysql wasn't running! Needed to have base db installed, and then rc-update add mysql default\n</li>\n</ul>\n<pre>chown -R mysql /var/lib/mysql/*\nchgrp daemon /var/lib/mysql/*\n</pre>\n<p><strong>New software config:</strong></p>\n<p>Linux: emerge gentoolkit</p>\n<p>Server software config:</p>\n<p>APACHE:</p>\n<p>ACCEPT<em>KEYWORDS=\"~x86\" emerge -p =net-www/apache-1.3.31 mod</em>ssl mysql</p>\n<p>Stupidly emerge unmerge openssl and broke wget! So now I am revdep-rebuild, that didn't work, so now trying again. My email to the list:</p>\n<p>These emails sometimes help out the bewildered when posted to GMANE and located through Google... I tried:</p>\n<p>ACCEPT<em>KEYWORDS=\"~x86\" emerge =net-www/apache-1.3.31 mod</em>ssl openssl mysql</p>\n<p>on a ck-sources machine with a reiser4 partition, something went wrong and it seemed like something had installed, so I</p>\n<p>ACCEPT<em>KEYWORDS=\"~x86\" emerge unmerge =net-www/apache-1.3.31 mod</em>ssl openssl mysql</p>\n<p>All it did was unmerge openssl. Uh-oh. It was already installed and very useful! It broke wget, and then I couldn't emerge anymore. I had done a stage3 and still had the tarball around so I cp'd it to /root/ and decompressed it. I found libssl* and libcrypt* in /usr/lib (had a feeling they would be in the right place) so I cp'd them to their natural locations and it fixed wget. Yeah! I then emerge openssl and everything seems cool.</p>\n<p>While I am at it I am revdep-rebuild and emerge -u world just in case, I'm not sure exactly what these do but I figure they can't hurt. I'm just trying to make this setup very stable.</p>\n<p>etc-update updates conf files in /etc</p>\n<pre>emerge sync\nemerge -uDpv world\nemerge -uDv world\nemerge -pv depclean - seriously, be careful using this! Make sure there really is a replacement for each item. Try and do each of the entries manually.\nemerge -v depclean\nrevdep-rebuild -pv\nrevdep-rebuild -v\ndispatch-conf\nglsa-check -l all\n</pre>\n<p>What is fixpackages? Moves binary packages from one directory to another in portage tree. That's all no biggie.</p>\n<p>After updating world, make sure you check all init scripts with a restart, and then check to make sure additional logins are working. Try logging in through another terminal, before you restart or logout.</p>\n<p>Big Question: Can I emerge sync with current firewall configuration?</p>\n<p>Last did all these updates on Houdini on July 27, 2004. Also for lewis and houdini, but need to install more packages for them also.!Semi-Final Configuration:    * 192.168.0.69    * Used ck-sources.    * Reiserfs /, Reiser4 /webserver, ext2 /boot (64MB), swap 512MB    * Emerge apache, samba, mod_ssl, mysql. rc-update them all, set up the confs.    * Compiled and install PHP with modules.</p>\n<p><strong>Final Configuration:</strong>    * Use Gentoo infrastructure design for your server. www.gentoo.org/proj/en/infrastructure/server-standards.xml</p>\n<p>make.conf   1. These settings were set by the catalyst build script that automatically built this stage   2. Please consult /etc/make.conf.example for a more detailed example</p>\n<pre>CFLAGS=\"-O2 -mcpu=i686 -fomit-frame-pointer -march=pentium3 -pipe\"\nCHOST=\"i686-pc-linux-gnu\"\nCXXFLAGS=\"${CFLAGS}\"\nMAKEOPTS=\"-j2\"\nGENTOO_MIRRORS=\"http://128.213.5.34/gentoo/\nhttp://mirror.datapipe.net/gentoo http://gentoo.mirrors.pair.com/\"#ftp://cudlug.cudenver.edu/pub/mirrors/distributions/gentoo/\"\nSYNC=\"rsync://160.36.178.159/gentoo-portage/\"#USE=\"-aalib -acpi -alsa -apm -arts -audiofile -avi -berkdb -bonobo -cdr -cscope -cups crypt curl -dga -direcfb -doc -dvd -emacs -evo -emacs -encode -ethereal -fam -fastcgi#fbcon fdftk -flac flash -foomaticdb -gb gd -gdbm gif ginac -gmp -gnome -gphoto2 -gpm -gps -gstreamer -gtk -gtk2 -gtkhtml -hardened imagemagick -icc -icc-pgo -icq -imap#-imlib jpeg -informix -ipv6 -jabber -jack -java jikes innodb -joystick -junit -kde -kerberos -krb4 -ladcca lcms -ldap -leim libwww -libgda -lirc -mad -maildir -mbox -mcal#-mikmod memlimit mmx -motif mysql -lesstif -mozilla -mpeg -mpi -msn -mule ncurses -nhc98 -netcdf nls nocd -nocardbus -oci8 -odbc -offensive -oggvorbis -opengl -oscar#-oss pam -pcmcia -pda -ppds -pnp -postgres pdflib perl png prelude python -qt -quicktime#readline ruby samba -scanner sasl -sdl -slang -slp -socks5 snmp spell -speex sse ssl -sqlite svga tcltk tcpd -tetex -theora tiff -truetype -trusted unicode usb vhosts#-videos -voodoo3 -wavelan wmf -wxwindows -X -xface -xinerama -xosd xml xml2 -xmms -xv yaz#-yahoo -zeo zlib x86\"\nUSE=\"-* ncurses ssl gd gif imagemagick jpeg innodb memlimit mysql nls samba tiff vhosts xml xml2 crypt berkdb tcpd pam xml perl python pic snmp mmx\"\nACCEPT_KEYWORDS=\"x86\"\nFEATURES=\"sandbox sfperms strict buildpkg\"\nLDFLAGS=\"-pie\"\n</pre>\n<p>Now we'll see if I am brave enough, or stupid enough to do this:</p>\n<pre>emerge -p bind-tools cfengine iptables keychain lsof net-snmp strace stunnel tcptraceroute grsec-sources\n</pre>\n<p><strong>Notes</strong>   1. for iptables, grsec-sources was required, therefore I had to get rid of reiser4 in lieu of reiserfs    * compiled and installed grsec - then found: www.gentoo.org/proj/en/hardened/grsecurity.xml which describes the actual kernel modifications in detail, so it might make sense to recompile the kernel using this info.</p>\n<p><strong>Setting up the ACL's</strong></p>\n<p>Setting all init scripts to 0700, these are the old values:</p>\n<pre>root@houdini init.d # ls -la\ntotal 162\ndrwxr-xr-x 2 root root 1056 May 26 17:30 .\ndrwxr-xr-x 37 root root 2840 Jun 4 08:16 ..-r-------- 1 root root 2530 May 24 14:17 apache2-rwxr-xr-x 1 root root 2809 May 20 22:16 bootmisc-rwxr-xr-x 1 root root 5120 May 20 22:16 checkfs-rwxr-xr-x 1 root root 2327 May 20 22:16 checkroot-rwxr-xr-x 1 root root 1963 May 20 22:16 clock-rwxr-xr-x 1 root root 1919 May 20 22:16 consolefont-rwxr-xr-x 1 root root 1191 May 20 22:16 crypto-loop-rwxr-x--- 1 root root 622 May 20 09:34 dcron\nlrwxrwxrwx 1 root root 21 May 20 22:16 depscan.sh -&gt; ../../sbin/depscan.sh-rwxr-xr-x 1 root root 1583 May 20 22:16 domainname\nlrwxrwxrwx 1 root root 23 May 20 22:16 functions.sh -&gt; ../../sbin/functions.sh-rwxr-xr-x 1 root root 5119 May 20 22:16 halt.sh-rwxr-xr-x 1 root root 2137 Apr 13 06:25 hdparm-rwxr-xr-x 1 root root 1607 May 20 22:16 hostname-rwxr-xr-x 1 root root 2092 May 26 16:49 iptables-rwxr-xr-x 1 root root 1123 May 20 22:16 keymaps-rwxr-xr-x 1 root root 728 May 20 22:16 local-rwxr-xr-x 1 root root 1637 May 20 22:16 localmount-rwxr-xr-x 1 root root 2944 May 20 22:16 modules-rwxr-xr-x 1 root root 953 May 21 07:04 mysql-rwxr-xr-x 1 root root 8823 May 20 22:16 net.eth0-rwxr-xr-x 1 root root 513 May 20 22:16 net.lo-rwxr-xr-x 1 root root 2522 May 20 22:16 netmount-rwxr-xr-x 1 root root 857 May 20 22:16 nscd-rwxr-xr-x 1 root root 912 May 20 22:16 numlock-rwxr-xr-x 1 root root 239 May 20 22:16 reboot.sh-rwxr-xr-x 1 root root 384 May 20 22:16 rmnologin-rwxr-xr-x 1 root root 423 Apr 13 06:07 rsyncd\nlrwxrwxrwx 1 root root 23 May 20 22:16 runscript.sh -&gt; ../../sbin/runscript.sh-rwxr-xr-x 1 root root 882 May 21 08:01 samba-rwxr-xr-x 1 root root 1105 May 20 22:16 serial-rwxr-xr-x 1 root root 239 May 20 22:16 shutdown.sh-rwxr-xr-x 1 root root 718 May 26 17:27 snmpd-rwxr-xr-x 1 root root 1286 May 20 22:16 sshd-rwxr-xr-x 1 root root 541 May 26 17:30 stunnel-rwxr-xr-x 1 root root 1339 May 20 09:32 syslog-ng-rwxr-xr-x 1 root root 928 May 20 22:16 urandom-rwxr-xr-x 1 root root 491 May 21 08:01 winbind\nroot@houdini init.d #\n</pre>\n<p>Made changes as prescribed in www.gentoo.org/proj/en/infrastructure/firewall/server-firewall.xml, created init and conf file, added reporting binary, now I am missing depscan.sh! Figured that out I think - (emerge ulugd or something like that) now trying to update world and keep getting errors about C cannot create executable, so just trying to update other stuff and hope that it works.</p>\n<p>Checking to see if the use flags are OK:    * ncurses ssl gd gif imagemagick jpeg innodb memlimit mysql nls samba tiff vhosts xml xml2 crypt berkdb tcpd pam xml perl python pic snmp</p>\n<p>It wasn't compiling apache2 because of the berkdb use flag, here is the new make.conf:   1. These settings were set by the catalyst build script that automatically built this stage   2. Please consult /etc/make.conf.example for a more detailed example</p>\n<p>CFLAGS=\"-O2 -mcpu=i686 -fomit-frame-pointer -pipe\"</p>\n<p>CHOST=\"i686-pc-linux-gnu\"</p>\n<p>CXXFLAGS=\"${CFLAGS}\"</p>\n<p>MAKEOPTS=\"-j2\"</p>\n<p>GENTOO_MIRRORS=\"<a href=\"http://128.213.5.34/gentoo/\">http://128.213.5.34/gentoo/</a></p>\n<p><a href=\"http://mirror.datapipe.net/gentoo\">http://mirror.datapipe.net/gentoo</a> <a href=\"http://gentoo.mirrors.pair.com/%22#ftp://cudlug.cudenver.edu/pub/mirrors/distributions/gentoo/\">http://gentoo.mirrors.pair.com/\"#ftp://cudlug.cudenver.edu/pub/mirrors/distributions/gentoo/</a>\"</p>\n<p>SYNC=\"rsync://rsync5.us.gentoo.org/gentoo-portage/\"#USE=\"-aalib -acpi -alsa -apm -arts -audiofile -avi -berkdb -bonobo -cdr -cscope -cups crypt curl -dga -direcfb -doc -dvd -emacs -evo -emacs -encode -ethereal -fam -fastcgi#fbcon fdftk -flac flash -foomaticdb -gb gd -gdbm gif ginac -gmp -gnome -gphoto2 -gpm -gps -gstreamer -gtk -gtk2 -gtkhtml -hardened imagemagick -icc -icc-pgo -icq -imap#-imlib jpeg -informix -ipv6 -jabber -jack -java jikes innodb -joystick -junit -kde -kerberos -krb4 -ladcca lcms -ldap -leim libwww -libgda -lirc -mad -maildir -mbox -mcal#-mikmod memlimit mmx -motif mysql -lesstif -mozilla -mpeg -mpi -msn -mule ncurses -nhc98 -netcdf nls nocd -nocardbus -oci8 -odbc -offensive -oggvorbis -opengl -oscar#-oss pam -pcmcia -pda -ppds -pnp -postgres pdflib perl png prelude python -qt -quicktime#readline ruby samba -scanner sasl -sdl -slang -slp -socks5 snmp spell -speex sse ssl -sqlite svga tcltk tcpd -tetex -theora tiff -truetype -trusted unicode usb vhosts#-videos -voodoo3 -wavelan wmf -wxwindows -X -xface -xinerama -xosd xml xml2 -xmms -xv yaz#-yahoo -zeo zlib x86\"</p>\n<p>USE=\"-* ncurses ssl gd gif imagemagick jpeg innodb memlimit mysql samba tiff vhosts xml xml2 crypt tcpd pam perl python snmp nls pic mmx zlib\"   1. Had to remove berkdb for some reason</p>\n<p>ACCEPT_KEYWORDS=\"x86\"</p>\n<p>FEATURES=\"sandbox sfperms strict buildpkg\"</p>\n<p>LDFLAGS=\"-pie\"</p>\n<p>Since then, emerge -a ulogd for firewall script, rc-update add firewall default, emerge -a gradm for acl gr-security . Next step is to configure ACLs. I was having a hell of a time getting the ACLs to work until finally someone explained to me I was using 1.9x rules on a 2.0 system. Now I'm using the learning tool to figure out what my system does, then I will activate it, and be done with it. This information comes from:</p>\n<pre>dev.gentoo.org/~solar/xml/grsecurity2.html\ngradm -F -L /etc/grsec/learning.log\ngradm -F -L /etc/grsec/learning.log -O /etc/grsec/learning.roles\nthen\ngradm -F -L /etc/grsec/learning.log -O /etc/grsec/acl\ngradm -E\neverything was disable, but it wasn't in my start up init, thankfully. I need to try the learning mode again for longer, then manually check the acl, then try to enable it, then see if it works OK, then try to set it up to automatically load upon startup.\n</pre>\n<p>For a hardened system, I essentially used grsec-sources, compiled in iptables and grsecurity support, disabled sysctl, enabled iptables, enabled gradm learning mode, and was done. I think its pretty much set, although I'd like to have a clearer idea of how I have this system setup so that it can be duplicated more easily. I've got 2 more servers coming that will need to be setup properly. Also need to make all initscripts readonly.</p>\n<p><strong>SSH Config:</strong></p>\n<pre>\n<code class=\"sh_sh\">Port 22\nProtocol 2\nServerKeyBits 2048\nSyslogFacility AUTH\nLogLevel INFO\nLoginGraceTime 60\nPermitRootLogin no\nRSAAuthentication no\nPubkeyAuthentication yes\nPasswordAuthentication no\nPermitEmptyPasswords no\nPAMAuthenticationViaKbdInt no\nCompression yes\nKeepAlive yes\nClientAliveInterval 30\nClientAliveCountMax 4\n</code>\n</pre>\n<p>Chmod 0400 /etc/init.d/*</p>\n<p>!SSL Config:</p>\n<p>www.enchantedyak.net/~carik/HOWTO/apache2.html</p>\n<p><strong>Apache</strong></p>\n<p>openssl - this is used to start webserver</p>\n<p><strong>August 31, 2004</strong></p>\n<p>Emerged cvs.</p>\n<p><strong>BIG IMPORTANT NOTE REGARDING UPDATING THE WORLD:</strong>Libcurl updates to 3, and the php module you have compiled looks for 2. So make sure to either re-compile php_module, or keep libcurl2. If you recompile the module, remove libcurl2 from Lewis, as that is how it is band-aided together.</p>\n<p><strong>January 14, 2005</strong><ul><li>Emerging awstats following instructions on blog.codefront.net/archives/2004/08/28/setting-up-awstats-on-gentoo/</li><li>AWStats now working</p>\n</li></ul>\n<p><strong>March 30, 2005</strong><ul><li>Rebuilding and upgrading the processor. Need to form a plan on how to deal with the security. GRSec? Hardened sourced? Speed?</li></ul></p>","frontmatter":{"title":"Houdini Server Setup OLD"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2005/2005-05-31-235/"}}