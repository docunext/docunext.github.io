<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.742409eb857ab2ccca34.css" data-identity="gatsby-global-css">li{margin-right:1rem}h1,li{display:inline-block}h1{font-style:normal;margin-top:0}header{margin-bottom:1.5rem}header ul{float:right;list-style:none}#wrapper{margin:3em auto;max-width:700px;padding:10px}.blogPostDate{color:#333;font-size:8pt;margin-bottom:9px;padding-top:4px}</style><meta name="generator" content="Gatsby 4.4.0"/><title data-react-helmet="true">Soekris net4501 m0n0wall error</title><link data-react-helmet="true" rel="canonical" href="https://www.docunext.com/2007/06/soekris-net4501-m0n0wall-error/"/><link as="script" rel="preload" href="/webpack-runtime-910253975eed29c257e8.js"/><link as="script" rel="preload" href="/framework-e27ef662c918f795a5a3.js"/><link as="script" rel="preload" href="/app-578f356f1ad3d3b2b65e.js"/><link as="script" rel="preload" href="/commons-bbb2797d08d51fd1bd26.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"/><link as="fetch" rel="preload" href="/page-data/2007/06/soekris-net4501-m0n0wall-error/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2191495970.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4224293195.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="wrapper"><header><ul><li><a href="/about/">About</a></li></ul><a href="/"><h1>Docunext</h1></a></header><hr/><div><h2>Soekris net4501 m0n0wall error</h2><div class="blogPostDate">June 17th, 2007</div><div><p>If I ssh into a shell through a vpn running on a WRAP behind a filtered bridge running on a net4501 and then run dmesg, ps -A, or ifconfig, the buffer outputs 2 lines, then dies.</p>
<p>However, if I ssh into that same machine behind the filtered bridge without going through the WRAP, I can run those commands without issue.</p>
<p>I think that the net4501 is having problems passing ipsec packets. Not sure if the problem is with the net4501 or with m0n0wall.</p>
<p>Someone on the m0n0wall mailing list suggested I try lowering the MTU, but I lowered it all the way to 1000 with no success.</p>
<p><a href="http://osdir.com/ml/security.firewalls.m0n0wall/2004-04/msg00029.html"><a href="http://osdir.com/ml/security.firewalls.m0n0wall/2004-04/msg00029.html">http://osdir.com/ml/security.firewalls.m0n0wall/2004-04/msg00029.html</a></a></p>
<p>I also noticed there is a button for allow fragmented packets on the firewall rules. Maybe that is it? Testing now...</p>
<p>Searching for:</p>
<p>m0n0wall ipsec packets filtered bridge</p>
<p>I'm also thinking it could be the magic traffic shaper. I'll turn that off and see if it helps. In about 10 minutes. The webGUI on the net4501 takes about 1 minutes for each click. Is this normal?</p>
<p>AHA! I didn't even have to. Turning on allow fragmented packets on the opt1 interface (which is bridged with wan) fixed the problem. Interesting. Since m0n0wall says that allowing fragmented packets on the firewall is not desired and not likely necessary due to higher load and potential dos attacks, I wanted to not use this option.</p>
<p>I remembered that I had turned on allow fragmented ipsec packets without reason on the vpn WRAPs, so I turned it off, and then turned off the allow fragmented packets on the firewalls, and everything still seems alright. Good!</p>
<p>UPDATE: Actually the problem is still happening, so I'm again going to turn on allowing fragmented packets on the firewall WAN interface and see if it goes away again. I turned it on the OPT1 port but no go.</p>
<p>UPDATE 2: I've confirmed that it is the fragmented packets on the WAN port.</p>
<h4><div id="net501-slowness"><strong>net4501 Slowness</strong></div>:</h4>
<p>system.php takes 1 minutes 15 seconds to load with current settings.</p>
<p>Factory defaults: 25 seconds. Wonder what it is about my config that is making it go so slow?</p>
<p>When OPT1 is added, system.php takes 50 seconds. After bridging with WAN, time seemed to decrease. Now I'm thinking it had something to do with the hardware watchdog or the device polling, both of which are now disabled.</p>
<p>I think that the slowness has something to do with the fact that I have a VPN setup through a filtered bridge. This will cause a shell to drop when I run commands like dmesg, ifconfig, or ps -A. This likely causes fragmented packets, which I guess are harder for the firewall to manage. I was able to improve the responsiveness of the net4501, but then the shell drops appeared again. I then restored to an earlier configuration,  and the shells are fine again, but the responsiveness is slow slow slow, around 1 minute per page load.</p>
<p>Just sent the about to the m0n0wall mailing list, plus this:</p>
<blockquote>Unfortunately I don't have the time to more rigorously test the setup to find out where the hangup is, but my personal conclusion is that I have two options:
<ul>
<li>
<p>faster net4501 that can't handle a vpn connection across two bridged interfaces</p>
</li>
<li>
<p>slower net4501 that can handle a vpn connection across two bridged interfaces</p>
</li>
</ul>
<p>Obviously I chose the latter, as I don't use the net4501 webgui everyday. Furthermore, I just purchased a couple net4801's, and I'll replace the filtered bridge with the 4801 so it can handle the fragmented packets better.</p>
<p>The net4501 is still a great box for the price, I just won't use it as a filtered bridge.</p>
<p>Lastly, I definitely retract what I said about the slowness being due to a php upgrade on the latest monowall, that definitely wasn't it!</blockquote></p>
<p>¥</p></div></div><div><span>Yearly Indexes: </span><span><a href="/2003/"><span>2003</span></a> </span><span><a href="/2004/"><span>2004</span></a> </span><span><a href="/2006/"><span>2006</span></a> </span><span><a href="/2007/"><span>2007</span></a> </span><span><a href="/2008/"><span>2008</span></a> </span><span><a href="/2009/"><span>2009</span></a> </span><span><a href="/2010/"><span>2010</span></a> </span><span><a href="/2011/"><span>2011</span></a> </span><span><a href="/2012/"><span>2012</span></a> </span><span><a href="/2013/"><span>2013</span></a> </span><span><a href="/2015/"><span>2015</span></a> </span><span><a href="/2019/"><span>2019</span></a> </span><span><a href="/2020/"><span>2020</span></a> </span><span><a href="/2022/"><span>2022</span></a> </span></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2007/06/soekris-net4501-m0n0wall-error/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9068a959998310636008.js"],"app":["/app-578f356f1ad3d3b2b65e.js"],"component---src-pages-about-js":["/component---src-pages-about-js-738961a9611f9aa4e8d4.js"],"component---src-pages-games-react-nuzaq-js":["/component---src-pages-games-react-nuzaq-js-50d5da494a82a1aaeb8b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-3aa2421409c5653df938.js"],"component---src-pages-years-js":["/component---src-pages-years-js-d36f319c6c16ef9e8314.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"],"component---src-templates-year-js":["/component---src-templates-year-js-e8af3ddab603f61c6142.js"]};/*]]>*/</script><script src="/polyfill-9068a959998310636008.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js" async=""></script><script src="/commons-bbb2797d08d51fd1bd26.js" async=""></script><script src="/app-578f356f1ad3d3b2b65e.js" async=""></script><script src="/framework-e27ef662c918f795a5a3.js" async=""></script><script src="/webpack-runtime-910253975eed29c257e8.js" async=""></script></body></html>