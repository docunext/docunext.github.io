<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.742409eb857ab2ccca34.css" data-identity="gatsby-global-css">li{margin-right:1rem}h1,li{display:inline-block}h1{font-style:normal;margin-top:0}header{margin-bottom:1.5rem}header ul{float:right;list-style:none}#wrapper{margin:3em auto;max-width:700px;padding:10px}.blogPostDate{color:#333;font-size:8pt;margin-bottom:9px;padding-top:4px}</style><meta name="generator" content="Gatsby 4.4.0"/><title data-react-helmet="true">Attempting to use Google s Thread Caching Memory Allocator tcmalloc Part I</title><link data-react-helmet="true" rel="canonical" href="https://www.docunext.com/2007/10/attempting-to-use-googles-tcmalloc-part-i/"/><link as="script" rel="preload" href="/webpack-runtime-910253975eed29c257e8.js"/><link as="script" rel="preload" href="/framework-e27ef662c918f795a5a3.js"/><link as="script" rel="preload" href="/app-578f356f1ad3d3b2b65e.js"/><link as="script" rel="preload" href="/commons-bbb2797d08d51fd1bd26.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"/><link as="fetch" rel="preload" href="/page-data/2007/10/attempting-to-use-googles-tcmalloc-part-i/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2191495970.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4224293195.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="wrapper"><header><ul><li><a href="/about/">About</a></li></ul><a href="/"><h1>Docunext</h1></a></header><hr/><div><h2>Attempting to use Google s Thread Caching Memory Allocator tcmalloc Part I</h2><div class="blogPostDate">October 26th, 2007</div><div><a href="http://www.docunext.com/2007/10/attempting-to-use-googles-tcmalloc-part-i/">
<p>I'm getting more interested in some of the more technical parts of computing, and so I decided to take a shot at compiling and using Google's tcmalloc.</p>
<p>I'll try <a href="http://www.csamuel.org/2006/12/15/now-using-googles-tcmalloc/">Chris Samuel's method</a>, as well as trying to compile custom apps using tcmalloc.</p>
<p>I just tried installing the debian package, but it depends on something I can't find...</p>
<p>So I compiled that, but I'm not sure how to let dpkg know its installed. In compiling the perftools, I read the INSTALL document and it recommended running make check, which I did, though first I tried make test because that's what I'm used to. The check appears quite in-depth.</p>
<p>The conclusion:</p>
<pre>
PASS: profiler_unittest.sh===================

All 21 tests passed===================</pre>
<p>The INSTALL also mentioned that the library can be used on RedHat, Ubuntu, and FreeBSD, but omitted debian, which I find strange.</p>
<p>Aha, so all I had to do was view all the downloads from the Google page, choose the non-dev version of the debian packages, and I was able to dpkg -i that. :-) Cool, now I don't have to hack /var/lib/dpkg!</p>
<p>Hmm. OK, I added:</p>
<p>export LD_PRELOAD=/usr/lib/libtcmalloc.so</p>
<p>to /etc/default/apache2, but I have no idea if Apache2 is indeed using this new lib. Good ol' debugging technique of testing for an obvious error by adding an extra character to the filename proves it is at least loading:</p>
<pre>
ERROR: ld.so: object '/usr/lib/libtcmalloce.so' from LD_PRELOAD cannot be preloaded: ignored. * Forcing reload of web server (apache2)...

ERROR: ld.so: object '/usr/lib/libtcmalloce.so' from LD_PRELOAD cannot be preloaded: ignored.

apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1 for ServerName

ERROR: ld.so: object '/usr/lib/libtcmalloce.so' from LD_PRELOAD cannot be preloaded: ignored.</pre>
<p><a href="http://code.google.com/p/google-perftools/"><a href="http://code.google.com/p/google-perftools/">http://code.google.com/p/google-perftools/</a></a></p>
<p>UPDATE November 21, 2007: I'm now using tcmalloc on a low-traffic, semi-production server, and so far its working.</p>
<p>UPATE February 10, 2008: I've compiled <a href="http://www.docunext.com/2008/02/swiftweasel-on-the-via-c7/">Iceweasel to link with Google's tcmalloc</a>, and plan to do more, including PHP, expat, libxml2, and libxslt.</p>
<p>¥</p></div></div><div><span>Yearly Indexes: </span><span><a href="/2003/"><span>2003</span></a> </span><span><a href="/2004/"><span>2004</span></a> </span><span><a href="/2006/"><span>2006</span></a> </span><span><a href="/2007/"><span>2007</span></a> </span><span><a href="/2008/"><span>2008</span></a> </span><span><a href="/2009/"><span>2009</span></a> </span><span><a href="/2010/"><span>2010</span></a> </span><span><a href="/2011/"><span>2011</span></a> </span><span><a href="/2012/"><span>2012</span></a> </span><span><a href="/2013/"><span>2013</span></a> </span><span><a href="/2015/"><span>2015</span></a> </span><span><a href="/2019/"><span>2019</span></a> </span><span><a href="/2020/"><span>2020</span></a> </span><span><a href="/2022/"><span>2022</span></a> </span></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2007/10/attempting-to-use-googles-tcmalloc-part-i/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9068a959998310636008.js"],"app":["/app-578f356f1ad3d3b2b65e.js"],"component---src-pages-about-js":["/component---src-pages-about-js-738961a9611f9aa4e8d4.js"],"component---src-pages-games-react-nuzaq-js":["/component---src-pages-games-react-nuzaq-js-50d5da494a82a1aaeb8b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-3aa2421409c5653df938.js"],"component---src-pages-years-js":["/component---src-pages-years-js-d36f319c6c16ef9e8314.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"],"component---src-templates-year-js":["/component---src-templates-year-js-e8af3ddab603f61c6142.js"]};/*]]>*/</script><script src="/polyfill-9068a959998310636008.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js" async=""></script><script src="/commons-bbb2797d08d51fd1bd26.js" async=""></script><script src="/app-578f356f1ad3d3b2b65e.js" async=""></script><script src="/framework-e27ef662c918f795a5a3.js" async=""></script><script src="/webpack-runtime-910253975eed29c257e8.js" async=""></script></body></html>