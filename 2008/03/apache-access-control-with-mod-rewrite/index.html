<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.742409eb857ab2ccca34.css" data-identity="gatsby-global-css">li{margin-right:1rem}h1,li{display:inline-block}h1{font-style:normal;margin-top:0}header{margin-bottom:1.5rem}header ul{float:right;list-style:none}#wrapper{margin:3em auto;max-width:700px;padding:10px}.blogPostDate{color:#333;font-size:8pt;margin-bottom:9px;padding-top:4px}</style><meta name="generator" content="Gatsby 4.4.0"/><title data-react-helmet="true">Apache Access Control with mod rewrite</title><link data-react-helmet="true" rel="canonical" href="https://www.docunext.com/2008/03/apache-access-control-with-mod-rewrite/"/><link as="script" rel="preload" href="/webpack-runtime-910253975eed29c257e8.js"/><link as="script" rel="preload" href="/framework-e27ef662c918f795a5a3.js"/><link as="script" rel="preload" href="/app-578f356f1ad3d3b2b65e.js"/><link as="script" rel="preload" href="/commons-bbb2797d08d51fd1bd26.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"/><link as="fetch" rel="preload" href="/page-data/2008/03/apache-access-control-with-mod-rewrite/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2191495970.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4224293195.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="wrapper"><header><ul><li><a href="/about/">About</a></li></ul><a href="/"><h1>Docunext</h1></a></header><hr/><div><h2>Apache Access Control with mod rewrite</h2><div class="blogPostDate">March 29th, 2008</div><div><p>I have a few BDB files which help manage comment spam on my blogs, and I'm starting to think about doing so in a more intelligent manner. Right now I have a big file with a bunch of IP addresses as the keys and simply a "1" as the value if I want them blocked. This is what I'd like to do more intelligently - use a variety of values to weigh the legitimacy of a visitor's POST request.</p>
<p>I am using mod_defensible as well as a few CIDR blocks to categorize visitors, and I also use WP-Spamfree which requires visitors to use javascript and allow cookies if they wish to post comments.</p>
<p>I'd like to move the functions in wp-spamfree to mod_rewrite if possible - maybe setting a cookie if a user-agent claims to be a browser.</p>
<p>It might even be possible to create an input filter using spamassassin to evaluate the content of a post.</p>
<p>One remaining question - would it be possible to calculate the sum of these values and block post requests which exceed a certain number?</p>
<p>And would it be possible to make this process configurable??</p>
<p>The user agent might actually be pretty helpful here - looks like almost all the browsers start with either "Mozilla" or "Opera", so if a visitor who wants to post claims to be either of those, they'll have to accept cookies.</p>
<p>This related link does a simple test to find if the User-Agent is empty and blocks it if it is:</p>
<p><a href="http://www.ap4a.co.uk/archives/2007/advanced-spam-control-with-mod_rewrite/"><a href="http://www.ap4a.co.uk/archives/2007/advanced-spam-control-with-mod_rewrite/">http://www.ap4a.co.uk/archives/2007/advanced-spam-control-with-mod_rewrite/</a></a></p>
<p>I also found this page helpful:</p>
<p><a href="http://http://www.perlcode.org/tutorials/apache/attacks.html"><a href="http://www.perlcode.org/tutorials/apache/attacks.html">http://www.perlcode.org/tutorials/apache/attacks.html</a></a></p>
<p>A few hours of testing a simple setup and I'm liking how this feels. I don't think a complex setup is merited for Apache, that complex test can be one at a higher level process. This is what I've got so far: * cookie setting and requirement for posting - this needs more work, but the idea is there* mod_defensible checking posters' ip address against xbl.spamhaus.org and list.dsbl.org* mod_rewrite checking poster's ip address against locally hashed dns block list</p>
<p>I'd like to have some higher level tools to confirm the presence of javascript as well as possible CAPTCHA tests. Another idea is to use an Apache input filter to stream the POST through spamassassin or some other rules / Bayesian-based processor.</p></div></div><div><span>Yearly Indexes: </span><span><a href="/2003/"><span>2003</span></a> </span><span><a href="/2004/"><span>2004</span></a> </span><span><a href="/2006/"><span>2006</span></a> </span><span><a href="/2007/"><span>2007</span></a> </span><span><a href="/2008/"><span>2008</span></a> </span><span><a href="/2009/"><span>2009</span></a> </span><span><a href="/2010/"><span>2010</span></a> </span><span><a href="/2011/"><span>2011</span></a> </span><span><a href="/2012/"><span>2012</span></a> </span><span><a href="/2013/"><span>2013</span></a> </span><span><a href="/2015/"><span>2015</span></a> </span><span><a href="/2019/"><span>2019</span></a> </span><span><a href="/2020/"><span>2020</span></a> </span><span><a href="/2022/"><span>2022</span></a> </span></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2008/03/apache-access-control-with-mod-rewrite/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9068a959998310636008.js"],"app":["/app-578f356f1ad3d3b2b65e.js"],"component---src-pages-about-js":["/component---src-pages-about-js-738961a9611f9aa4e8d4.js"],"component---src-pages-games-react-nuzaq-js":["/component---src-pages-games-react-nuzaq-js-50d5da494a82a1aaeb8b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-3aa2421409c5653df938.js"],"component---src-pages-years-js":["/component---src-pages-years-js-d36f319c6c16ef9e8314.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"],"component---src-templates-year-js":["/component---src-templates-year-js-e8af3ddab603f61c6142.js"]};/*]]>*/</script><script src="/polyfill-9068a959998310636008.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js" async=""></script><script src="/commons-bbb2797d08d51fd1bd26.js" async=""></script><script src="/app-578f356f1ad3d3b2b65e.js" async=""></script><script src="/framework-e27ef662c918f795a5a3.js" async=""></script><script src="/webpack-runtime-910253975eed29c257e8.js" async=""></script></body></html>