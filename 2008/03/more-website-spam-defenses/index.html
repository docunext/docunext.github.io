<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.742409eb857ab2ccca34.css" data-identity="gatsby-global-css">li{margin-right:1rem}h1,li{display:inline-block}h1{font-style:normal;margin-top:0}header{margin-bottom:1.5rem}header ul{float:right;list-style:none}#wrapper{margin:3em auto;max-width:700px;padding:10px}.blogPostDate{color:#333;font-size:8pt;margin-bottom:9px;padding-top:4px}</style><meta name="generator" content="Gatsby 4.4.0"/><title data-react-helmet="true">More Website Spam Defenses with Apache</title><link data-react-helmet="true" rel="canonical" href="https://www.docunext.com/2008/03/more-website-spam-defenses/"/><link as="script" rel="preload" href="/webpack-runtime-910253975eed29c257e8.js"/><link as="script" rel="preload" href="/framework-e27ef662c918f795a5a3.js"/><link as="script" rel="preload" href="/app-578f356f1ad3d3b2b65e.js"/><link as="script" rel="preload" href="/commons-bbb2797d08d51fd1bd26.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"/><link as="fetch" rel="preload" href="/page-data/2008/03/more-website-spam-defenses/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2191495970.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4224293195.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="wrapper"><header><ul><li><a href="/about/">About</a></li></ul><a href="/"><h1>Docunext</h1></a></header><hr/><div><h2>More Website Spam Defenses with Apache</h2><div class="blogPostDate">March 15th, 2008</div><div><p>I've written about blocking POST requests before, and thanks to WP-Spamfree I've found another way to do so - with cookies, like so:</p>
<pre class="sh_sh">RewriteCond  %{HTTP_USER_AGENT}  ^Mozilla.*
RewriteRule . - [CO=barf:blah:%{HTTP_HOST}]
RewriteCond %{REQUEST_METHOD} POST
RewriteCond %{HTTP_COOKIE} !blah
RewriteRule . - [F]</pre>
<p>Obviously that is just conceptual code, but its a start. I'd like to use an environment variable for the cookie name, only set it once, and only set it for user agents that would presumably be posting. On the flip side, something like WP-Spamfree could then use javascript to further validate the user agent's "realness".</p>
<p>Considering how much email spam has increased over the past few years, my guess is that website spam will do the same.</p>
<p>While I'm at it I should mention that I took another look at mod_defensible last night. I'd like to be able to use it only for POST requests, so I'll take another look at the mod_defensible code, adding something like this:</p>
<pre class="sh_c">char *request = apr_pstrdup(r-&gt;pool, apr_table_get(r-&gt;headers_in, "method"));</pre>
<p>to get the method, then only do the dnsbl lookup if the method is configured to be inspected. In my past experience, I ran into a significant problem with mod_defensible when used with udns (i.e. no timeout), but since I run dnsmasq on most of my firewalls (pfsense / m0n0wall) it shouldn't be a big deal. Still, I don't want to check (or block) every get request, only posts.</p>
<p>See:</p>
<p><a href="http://www.docunext.com/2007/10/server-based-comment-spam-protection/">Server Based Comment Spam Protection</a> (Papa Smurf tells it like it is.)</p>
<p><a href="http://www.docunext.com/">Protecting against bad bots</a></p>
<p>Also:</p>
<p><a href="http://thomas.eibner.dk/apache/table.html"><a href="http://thomas.eibner.dk/apache/table.html">http://thomas.eibner.dk/apache/table.html</a></a></p></div></div><div><span>Yearly Indexes: </span><span><a href="/2003/"><span>2003</span></a> </span><span><a href="/2004/"><span>2004</span></a> </span><span><a href="/2006/"><span>2006</span></a> </span><span><a href="/2007/"><span>2007</span></a> </span><span><a href="/2008/"><span>2008</span></a> </span><span><a href="/2009/"><span>2009</span></a> </span><span><a href="/2010/"><span>2010</span></a> </span><span><a href="/2011/"><span>2011</span></a> </span><span><a href="/2012/"><span>2012</span></a> </span><span><a href="/2013/"><span>2013</span></a> </span><span><a href="/2015/"><span>2015</span></a> </span><span><a href="/2019/"><span>2019</span></a> </span><span><a href="/2020/"><span>2020</span></a> </span><span><a href="/2022/"><span>2022</span></a> </span></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2008/03/more-website-spam-defenses/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9068a959998310636008.js"],"app":["/app-578f356f1ad3d3b2b65e.js"],"component---src-pages-about-js":["/component---src-pages-about-js-738961a9611f9aa4e8d4.js"],"component---src-pages-games-react-nuzaq-js":["/component---src-pages-games-react-nuzaq-js-50d5da494a82a1aaeb8b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-3aa2421409c5653df938.js"],"component---src-pages-years-js":["/component---src-pages-years-js-d36f319c6c16ef9e8314.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"],"component---src-templates-year-js":["/component---src-templates-year-js-e8af3ddab603f61c6142.js"]};/*]]>*/</script><script src="/polyfill-9068a959998310636008.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js" async=""></script><script src="/commons-bbb2797d08d51fd1bd26.js" async=""></script><script src="/app-578f356f1ad3d3b2b65e.js" async=""></script><script src="/framework-e27ef662c918f795a5a3.js" async=""></script><script src="/webpack-runtime-910253975eed29c257e8.js" async=""></script></body></html>