<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.742409eb857ab2ccca34.css" data-identity="gatsby-global-css">li{margin-right:1rem}h1,li{display:inline-block}h1{font-style:normal;margin-top:0}header{margin-bottom:1.5rem}header ul{float:right;list-style:none}#wrapper{margin:3em auto;max-width:700px;padding:10px}.blogPostDate{color:#333;font-size:8pt;margin-bottom:9px;padding-top:4px}</style><meta name="generator" content="Gatsby 4.4.0"/><title data-react-helmet="true">Postfix Dovecot and Spamassassin</title><link data-react-helmet="true" rel="canonical" href="https://www.docunext.com/2009/07/dovecot-and-spamassassin/"/><link as="script" rel="preload" href="/webpack-runtime-910253975eed29c257e8.js"/><link as="script" rel="preload" href="/framework-e27ef662c918f795a5a3.js"/><link as="script" rel="preload" href="/app-578f356f1ad3d3b2b65e.js"/><link as="script" rel="preload" href="/commons-bbb2797d08d51fd1bd26.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"/><link as="fetch" rel="preload" href="/page-data/2009/07/dovecot-and-spamassassin/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2191495970.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4224293195.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="wrapper"><header><ul><li><a href="/about/">About</a></li></ul><a href="/"><h1>Docunext</h1></a></header><hr/><div><h2>Postfix Dovecot and Spamassassin</h2><div class="blogPostDate">July 7th, 2009</div><div><p>One thing I really like about Courier is the fact that I can filter messages with Spamassassin from a maildroprc file, essentially as an after queue postfix filter. Upon retrospect, it is probably a good thing that sieve scripts cannot execute arbitrary system commands!</p>
<p>So how should Spamassassin get integrated into a Dovecot / Postfix world?</p>
<p>As I see it, there are two options:</p>
<ul><li>As a content filter</li><li>Through a spampd relay proxy
</li></ul>Although another option might be to use a spamassassin milter. I'll have to read up on that.
<p>While I'm at it, I need to read up on Amavis, ClamAV and DSpam.</p>
<p>UPDATE: Looks like a spamassassin milter or a spampd relay proxy might be the way to go. It would be nice to flag some messages as spam, and flat out reject (before queue) other messages that have a very high spam rating.</p>
<p>The problem with a before queue filter / proxy relay is that all incoming mail must be either accepted or rejected. To reject mail, it must be analyzed. If its not rejected, then it would be bounced if its not deliverable, causing potential backscatter spam.</p>
<p>So, a post-queue content filter is really the way to go. So how should it be configured? There are many ways, and a proxy relay can be configured as a post content filter too. Milters are before-queue, so how about a Postfix content_filter using spampd as a proxy relay or as a content_filter? Decisions, decisions...</p>
<p>Probably a proxy relay, as Postfix supports sender dependent relay hosts, which is interesting. Thankfully there are a number of smtp proxies out there which could potentially be used as a conduit to spamassassin. I actually prefer using spamc though... because it can connect to remote spamassassin hosts as a specific user. Also, by using a spamc content filter, the filtering could take place on the gateway. I'll have to check into how to specify different users, exclude certain messages by header content, and so on.</p>
<p>Also noting: if I remove courier and maildrop, I'll use Dovecot as the LMTP / virtual transport. Need to figure out how to do that.</p>
<p>Links:</p>
<ul><li><a href="http://wiki.apache.org/spamassassin/IntegratePostfixViaSpampd">Spamassassin as a Before Queue Postfix Filter or Relay Proxy</a></li><li><a href="http://wiki.apache.org/spamassassin/IntegratedSpamdInPostfix">Spamassassin as an After Queue Postfix Filter</a></li><li><a href="http://www.postfix.org/FILTER_README.html">Postfix Filter READ</a>
</li></ul></div></div><div><span>Yearly Indexes: </span><span><a href="/2003/"><span>2003</span></a> </span><span><a href="/2004/"><span>2004</span></a> </span><span><a href="/2006/"><span>2006</span></a> </span><span><a href="/2007/"><span>2007</span></a> </span><span><a href="/2008/"><span>2008</span></a> </span><span><a href="/2009/"><span>2009</span></a> </span><span><a href="/2010/"><span>2010</span></a> </span><span><a href="/2011/"><span>2011</span></a> </span><span><a href="/2012/"><span>2012</span></a> </span><span><a href="/2013/"><span>2013</span></a> </span><span><a href="/2015/"><span>2015</span></a> </span><span><a href="/2019/"><span>2019</span></a> </span><span><a href="/2020/"><span>2020</span></a> </span><span><a href="/2022/"><span>2022</span></a> </span></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2009/07/dovecot-and-spamassassin/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9068a959998310636008.js"],"app":["/app-578f356f1ad3d3b2b65e.js"],"component---src-pages-about-js":["/component---src-pages-about-js-738961a9611f9aa4e8d4.js"],"component---src-pages-games-react-nuzaq-js":["/component---src-pages-games-react-nuzaq-js-50d5da494a82a1aaeb8b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-3aa2421409c5653df938.js"],"component---src-pages-years-js":["/component---src-pages-years-js-d36f319c6c16ef9e8314.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"],"component---src-templates-year-js":["/component---src-templates-year-js-e8af3ddab603f61c6142.js"]};/*]]>*/</script><script src="/polyfill-9068a959998310636008.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js" async=""></script><script src="/commons-bbb2797d08d51fd1bd26.js" async=""></script><script src="/app-578f356f1ad3d3b2b65e.js" async=""></script><script src="/framework-e27ef662c918f795a5a3.js" async=""></script><script src="/webpack-runtime-910253975eed29c257e8.js" async=""></script></body></html>