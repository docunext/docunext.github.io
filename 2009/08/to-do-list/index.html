<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.742409eb857ab2ccca34.css" data-identity="gatsby-global-css">li{margin-right:1rem}h1,li{display:inline-block}h1{font-style:normal;margin-top:0}header{margin-bottom:1.5rem}header ul{float:right;list-style:none}#wrapper{margin:3em auto;max-width:700px;padding:10px}.blogPostDate{color:#333;font-size:8pt;margin-bottom:9px;padding-top:4px}</style><meta name="generator" content="Gatsby 4.4.0"/><title data-react-helmet="true">To Do List Plus XML dbrs2xml erubis MySQL FastCGI</title><link data-react-helmet="true" rel="canonical" href="https://www.docunext.com/2009/08/to-do-list/"/><link as="script" rel="preload" href="/webpack-runtime-910253975eed29c257e8.js"/><link as="script" rel="preload" href="/framework-e27ef662c918f795a5a3.js"/><link as="script" rel="preload" href="/app-578f356f1ad3d3b2b65e.js"/><link as="script" rel="preload" href="/commons-bbb2797d08d51fd1bd26.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"/><link as="fetch" rel="preload" href="/page-data/2009/08/to-do-list/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2191495970.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4224293195.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="wrapper"><header><ul><li><a href="/about/">About</a></li></ul><a href="/"><h1>Docunext</h1></a></header><hr/><div><h2>To Do List Plus XML dbrs2xml erubis MySQL FastCGI</h2><div class="blogPostDate">August 8th, 2009</div><div><p>Here's a few items on my to-do list:</p>
<ul><li>Write a module for NGINX
</li><li>Switch to using Ruby as my primary high-level programming language</li><li>Create a qDecoder debian package for my own use (I have no clue how to get a package into the official repositories)</li><li>Examine various non-XSL template syntax for plain-text output (ERB, Lesscss, TT, macros?)</li></ul>
The last item is an interesting thought, and I've just spent the last thirty minutes thinking and researching it. I don't like the idea of moving away from XML, but I don't think I will. While it is certainly possible to output plain text from XSL, it is isn't very elegant.
<p>One idea would be to use XSLT to convert an XML source document to a language specific data file. This worked well for lua, and some languages have support for "simplexml", which quickly convert an XML document to a language specific data structure.</p>
<p>OK, enough technical garbledeegook... how about a real world example?</p>
<p>I have <a href="http://www.informedbanking.com/">a large database of banks</a>,
and I'm trying to make the data more navigable, as well as potentially
render it as static content. So, I've come up with a plan:</p>
<ul><li>create an xml file of every state (440 / state average)</li><li>create an xml file of each starting letter, f would be huge</li><li>number of branches:</li><ul><li>1 - 10</li><li>11 - 100</li><li>101 - 500</li><li>501 - 1000</li><li>1001 +
<pre><code>&#x3C;/li>&#x3C;/ul>&#x3C;/ul>
</code></pre>
<p>Simple enough, but there is a fair amount of work involved. Thanks to
programming, it shouldn't be that bad - it might even be fun!</p>
<p>First off, I'm using dbrs2xml to convert data from a MySQL result set to XML. Its a FastCGI binary coded in C, but it can run as a command line application with two environment variables: SQL_NAME and SQL_QUERY. The SQL_NAME is used for the XML document, and SQL_QUERY is the SQL_QUERY. I have an XML document of all fifty states in the US, so I'm going to use Ruby's simplexml to parse it. Here's a snibbet of the states.xml file:</p>
<pre class="sh_xml">&lt;states&gt;
&lt;state label="Alabama" value="AL"&gt;Alabama&lt;/state&gt;
&lt;state label="Alaska" value="AK"&gt;Alaska&lt;/state&gt;&lt;/states&gt;</pre>
<p>Simple enough, now let's create some commands from that data set with Ruby and an eRuby template.</p>
<p><b>sqlcommands.eruby template</b></p>
<pre class="sh_ruby">&lt;% for item in list %&gt;
SQL_NAME="banks_get_all" SQL_QUERY="SELECT name,address_line_1,city,state,zip,offices,website FROM banks WHERE state='&lt;%= item['value'] %&gt;'"  ./dbrs2xml.fcgi &gt; &lt;%= item['value'].downcase %&gt;.xml
&lt;% end %&gt;</pre>
<p><b>myprocessor.rb Ruby code:</b></p>
<pre class="sh_ruby">require 'xmlsimple'
require 'erubis'
list = XmlSimple.xml_in('states.xml', { })['state']
input = File.read('sqlcommands.eruby')
eruby = Erubis::Eruby.new(input)
puts eruby.result(binding())
</pre>
<p>The result is a shell script which when run will produce 50 xml files, one for each state. Cool huh? I can then use xsltproc to convert those to html/xhtml if I like - I can even include the xsltproc commands in the eruby template. And using some similar templates and processes, I'll be able to finish the rest of the goals in my plan. Not bad at all!</p>
<p>¥</p></div></div><div><span>Yearly Indexes: </span><span><a href="/2003/"><span>2003</span></a> </span><span><a href="/2004/"><span>2004</span></a> </span><span><a href="/2006/"><span>2006</span></a> </span><span><a href="/2007/"><span>2007</span></a> </span><span><a href="/2008/"><span>2008</span></a> </span><span><a href="/2009/"><span>2009</span></a> </span><span><a href="/2010/"><span>2010</span></a> </span><span><a href="/2011/"><span>2011</span></a> </span><span><a href="/2012/"><span>2012</span></a> </span><span><a href="/2013/"><span>2013</span></a> </span><span><a href="/2015/"><span>2015</span></a> </span><span><a href="/2019/"><span>2019</span></a> </span><span><a href="/2020/"><span>2020</span></a> </span><span><a href="/2022/"><span>2022</span></a> </span></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2009/08/to-do-list/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9068a959998310636008.js"],"app":["/app-578f356f1ad3d3b2b65e.js"],"component---src-pages-about-js":["/component---src-pages-about-js-738961a9611f9aa4e8d4.js"],"component---src-pages-games-react-nuzaq-js":["/component---src-pages-games-react-nuzaq-js-50d5da494a82a1aaeb8b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-3aa2421409c5653df938.js"],"component---src-pages-years-js":["/component---src-pages-years-js-d36f319c6c16ef9e8314.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js"],"component---src-templates-year-js":["/component---src-templates-year-js-e8af3ddab603f61c6142.js"]};/*]]>*/</script><script src="/polyfill-9068a959998310636008.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-cc8ebf9459c2ce2cf980.js" async=""></script><script src="/commons-bbb2797d08d51fd1bd26.js" async=""></script><script src="/app-578f356f1ad3d3b2b65e.js" async=""></script><script src="/framework-e27ef662c918f795a5a3.js" async=""></script><script src="/webpack-runtime-910253975eed29c257e8.js" async=""></script></body></html>