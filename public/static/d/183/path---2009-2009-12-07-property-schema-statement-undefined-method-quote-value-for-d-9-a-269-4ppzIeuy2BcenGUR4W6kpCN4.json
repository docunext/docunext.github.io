{"data":{"markdownRemark":{"html":"<p>Just updated DataMapper:</p>\n<pre class=\"sh_sh\">\n$ sudo gem install dm-core\nSuccessfully installed extlib-0.9.13\nSuccessfully installed addressable-2.1.1\nSuccessfully installed dm-core-0.10.1\n</pre>\n<p>But now I'm getting this error....</p>\n<pre class=\"sh_sh\">\nmigrations.rb:279:in `property_schema_statement': undefined method `quote_value' for #<DataObjects::Sqlite3::Connection:0xb74845b0> (NoMethodError)\n</pre>\n<p>Looks like I'm missing something....</p>\n<pre class=\"sh_sh\">\nsudo gem install data_objects\nsudo gem install do_sqlite3\n</pre>\n<p>Had to remove the dpkgs too:</p>\n<pre class=\"sh_sh\">\n$ sudo apt-get remove libdataobjects-ruby1.8\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nThe following packages were automatically installed and are no longer required:\n  libio-compress-zlib-perl libcompress-raw-zlib-perl mailfront libmatrixssl1.8 libhttp-response-encoding-perl python-numeric libio-compress-base-perl libparted1.8-12 ipsvd\n  libevtlog0\nUse 'apt-get autoremove' to remove them.\nThe following packages will be REMOVED:\n  libdataobjects-mysql-ruby1.8 libdataobjects-postgres-ruby1.8 libdataobjects-ruby1.8 libdataobjects-sqlite3-ruby1.8\n0 upgraded, 0 newly installed, 4 to remove and 500 not upgraded.\nAfter this operation, 537kB disk space will be freed.\nDo you want to continue [Y/n]?\n(Reading database ... 119767 files and directories currently installed.)\nRemoving libdataobjects-mysql-ruby1.8 ...\nRemoving libdataobjects-postgres-ruby1.8 ...\nRemoving libdataobjects-sqlite3-ruby1.8 ...\nRemoving libdataobjects-ruby1.8 ...\n</pre>\n<p>That worked!</p>\n<p>...but the hooks are giving me trouble again... and also my associations... DOH!</p>\n<p>This is very strange...  it appears that I cannot use the dm-aggregate sum function with an inherited class?</p>\n<pre class=\"sh_ruby\">\nclass Entry\n  include DataMapper::Resource\n\n  property :id,Serial\n  property :memorandum,String\n  property :status,Integer\n  property :fiscal_period_id,Integer\n  property :entered_on,Integer, :default => Time.now.to_i\n  has n, :ledgers\n\n  def credit_sum\n    # Does not work:\n    # !! Unexpected error while processing request:\n    # +options[:fields]+ entry #<DataMapper::Property @model=Amount @name=:amount>\n    # does not map to a property in Credit\n    #return Credit.sum(:amount, :entry_id => self.id)\n\n    # Works fine, but isn't it the same thing?\n    return Amount.sum(:amount, :type => 'Credit', :entry_id => self.id)\n  end\nend\n\nclass Amount\n  include DataMapper::Resource\n\n  property :id,Serial\n  property :entry_id,Integer\n  property :type,Discriminator\n  property :amount,Integer\n  property :account_id,Integer\n  property :memorandum,String\n  property :currency_id,Integer\n  belongs_to :entry, :model => 'Entry', :child_key => [:entry_id, Integer]\n\n  def to_usd\n      return \"%.2f\" % (self.amount.to_r.to_d / 100)\n  end\n  def self.sum_usd\n    return self.entry.credits.sum(:amount)\n  end\n\nend\n\nclass Credit &lt; Amount; end\nclass Debit &lt; Amount; end\n</pre>\n<p>Thought it might have been caused by some outdated libraries... but I've just cleared out some older libraries, still no luck.</p>\n<ul>\n<li><a href=\"http://gist.github.com/200093\">http://gist.github.com/200093</a></li>\n<li><a href=\"http://datamapper.lighthouseapp.com/projects/20609/tickets/1147-cant-use-dm-aggregate-sum-function-on-inherited-classes\">http://datamapper.lighthouseapp.com/projects/20609/tickets/1147-cant-use-dm-aggregate-sum-function-on-inherited-classes</a></li>\n</ul>","frontmatter":{"title":"property schema statement undefined method quote value for","date":"December 7th, 2009"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2009/2009-12-07-property-schema-statement-undefined-method-quote-value-for/"}}