<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:87.5%/1.714 'Open Sans',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.73);font-family:'Open Sans',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.6rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.32578rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.20684rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.91028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.86849rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}ul{margin-left:1.714rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;list-style-position:outside;list-style-image:none;list-style:disc outside;}ol{margin-left:1.714rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;list-style-position:outside;list-style-image:none;list-style:decimal outside;}dl{margin-left:1.714rem;margin-right:1.714rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.714rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;font-size:0.91028rem;line-height:1.714rem;border-collapse:collapse;width:100%;color:hsla(0,0%,0%,0.54);}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}blockquote{margin-left:1.714rem;margin-right:1.714rem;margin-top:0;padding-bottom:1.714rem;padding-left:1.714rem;padding-right:1.714rem;padding-top:1.714rem;margin-bottom:1.714rem;font-style:italic;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.714rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.714rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;text-transform:uppercase;color:hsla(0,0%,0%,0.61);}li{margin-bottom:calc(1.714rem / 2);margin-left:2.571rem;}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.714rem;margin-bottom:calc(1.714rem / 2);margin-top:calc(1.714rem / 2);}li > ul{margin-left:1.714rem;margin-bottom:calc(1.714rem / 2);margin-top:calc(1.714rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.714rem / 2);}code{font-size:0.85rem;line-height:1.714rem;}kbd{font-size:0.85rem;line-height:1.714rem;}samp{font-size:0.85rem;line-height:1.714rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.14267rem;padding-right:1.14267rem;padding-top:0.857rem;padding-bottom:calc(0.857rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:"Â ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:none;}ol,ul{margin-left:0;}a{color:#21759b;}a:hover{color:#0f3647;}a:visited{color:#9f9f9f;}</style><meta name="generator" content="Gatsby 2.4.2"/><title data-react-helmet="true">Another Gotcha with the Rails 3.1 Asset Pipeline Or Why Are My jquery ujs AJAX Requests Triggered Twice</title><link href="//fonts.googleapis.com/css?family=Open+Sans:400,400i,700" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/1-dd7c0a064660cc51b5d6.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-fa43ce5e61c19e65ef7c.js"/><link as="script" rel="preload" href="/0-03d194fc431facdf311b.js"/><link as="script" rel="preload" href="/app-b3a037db3f0513c90691.js"/><link as="script" rel="preload" href="/webpack-runtime-6f7fe88ae22f5123451b.js"/><link as="fetch" rel="preload" href="/static/d/730/path---2011-2011-10-15-another-gotcha-with-the-rails-31-asset-pipeline-or-why-are-my-jquery-ujs-ajax-requests-triggered-twi-bcb-7da-PoCEnLbMhSyRqPZmk28BvBSnv4.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><style data-emotion-css="1ycjowu">.css-1ycjowu{margin:0 auto;max-width:700px;padding:3.428rem;padding-top:2.571rem;}</style><div class="css-1ycjowu"><header style="margin-bottom:1.5rem"><a href="/"><style data-emotion-css="14036a">.css-14036a{margin-top:0;margin-bottom:1.714rem;display:inline-block;font-style:normal;}</style><h1 class="css-14036a">Docunext</h1></a><ul style="list-style:none;float:right"><style data-emotion-css="146q31f">.css-146q31f{float:right;}</style><li style="display:inline-block;margin-right:1rem"><a href="/about/">About</a></li></ul></header><hr/><div><h2>Another Gotcha with the Rails 3.1 Asset Pipeline Or Why Are My jquery ujs AJAX Requests Triggered Twice</h2><div><h4>This gotcha with the Rails 3.1 Asset Pipeline is tricky!</h4>
<p>Say you want to statically render your assets for your production environment, but don't want to use a digest.</p>
<p><strong>Watch out!</strong> If you do so in the working directory of your development environment, you might end up including all your assets twice. You might not even notice unless <strong>jquery-ujs powered ajax requests like form submits get triggered twice</strong>.</p>
<p>Here's what happened to me:</p>
<ol>
<li>I set config.assets.digest = false in config/environments/production.rb.</li>
<li>I ran rake assets:precompile from within my development working directory. This resulted in the files I specified in app/assets/javascripts/application.js to get bundled into a single file located in public/assets/application.js.</li>
<li>Then when I would run a development server from within that same development working environment, the assets pipeline would generate links to the javascript files I specified in app/assets/javascripts/application.js, including one for 'assets/application.js'.</li>
<li>The response for the request to 'assets/application.js' would be the static file in the public directory. <strong>Uh-oh - that one already contains the bundle of all the files specified in 'app/assets/javascripts/application.js'</strong>!</li>
<li>Sure, it makes sense to have RedBrick or Thin-based Rack servers serve static files in development mode, but perhaps, if the assets pipeline is on, it should skip serving the static files in public/assets/application.js or public/assets/application.css?</li>
</ol>
<p>As a workaround, I set my config.assets.prefix in config/environments/development.rb to /devassets. Then of course I have to handle images for web-app-theme (and rails admin, too probably), so I created a folder in public called devassets and created symlink in it to public/images/web-app-theme.</p>
<p>Its a pain, sure, but I'm confident these asset pipeline issues will get sorted out soon enough.</p>
<p>I also discuss this at StackOverflow:</p>
<blockquote><pre>
Thanks to this dialog:
<p><a href="https://github.com/rails/jquery-ujs/issues/208">https://github.com/rails/jquery-ujs/issues/208</a></p>
<p>I was able to discover that jquery and jquery_ujs were getting included twice.</p>
<p>I guess the jquery-rails gem automatically puts them into application.js, and then I had them included in application.js as well.</p>
<p>Seems like for whatever reason application.js automatically bundles everything in app/assets/javascripts/ - even when I remove all the requires.</p>
<p>So, if your :remote => true forms are getting submitted twice, try checking application.js.</p>
<p>Hope this helps!</p>
<p>UPDATE: I believe this might have had something to do with me pre-rendering my assets without using a digest, so then when my development environment adds script tags in the html head dynamically from the requires in app/assets/application.js, it also adds one for what should be an empty dynamic application.js, except the static one from public/assets gets loaded. Confusing? Yep!</p>
</pre></blockquote>
<p>Github:</p>
<blockquote><pre>
I have an idea as to why this might happen more that we'd expect. Take this scenario:
<p>Production env has assets digest turned off, rakes precompile assets, which creates application.js in public/assets/. Running in dev mode, the app/assets/javascripts/application.js seperately includes the files in isolated script tags, but also includes the default application.js file, which has the same path as the statically rendered one, which in this case bundles the already included files. I get around this by setting config.assets.prefix to '/devassets' in config/environments/development.rb.</p>
</pre></blockquote>
<p>Â¥</p></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"2011-2011-10-15-another-gotcha-with-the-rails-31-asset-pipeline-or-why-are-my-jquery-ujs-ajax-requests-triggered-twi-bcb","path":"/2011/2011-10-15-another-gotcha-with-the-rails-31-asset-pipeline-or-why-are-my-jquery-ujs-ajax-requests-triggered-twi/"};window.dataPath="730/path---2011-2011-10-15-another-gotcha-with-the-rails-31-asset-pipeline-or-why-are-my-jquery-ujs-ajax-requests-triggered-twi-bcb-7da-PoCEnLbMhSyRqPZmk28BvBSnv4";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-b3a037db3f0513c90691.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-fa43ce5e61c19e65ef7c.js"],"component---src-pages-about-js":["/component---src-pages-about-js-bc02bbc13e5fe52afb57.js"],"component---src-pages-index-js":["/component---src-pages-index-js-6bac0da1b67b4ccf4d11.js"],"component---src-pages-my-files-js":["/component---src-pages-my-files-js-4ca90275b4e81ff0a8db.js"],"pages-manifest":["/pages-manifest-5a1618dfe618a2807967.js"]};/*]]>*/</script><script src="/webpack-runtime-6f7fe88ae22f5123451b.js" async=""></script><script src="/app-b3a037db3f0513c90691.js" async=""></script><script src="/0-03d194fc431facdf311b.js" async=""></script><script src="/component---src-templates-blog-post-js-fa43ce5e61c19e65ef7c.js" async=""></script><script src="/1-dd7c0a064660cc51b5d6.js" async=""></script></body></html>