{"componentChunkName":"component---src-templates-blog-post-js","path":"/2007/07/qemu-vde-notes-revisited/","result":{"data":{"site":{"siteMetadata":{"domain":"https://www.docunext.com"}},"markdownRemark":{"html":"<p>It is happening again... so here are lots of lots of notes on setting up QEMU, VDE, FreeBSD, Debian, tun/tap.</p>\n<p>QEMU direct to a host bridge via tap0 only allows for one guest per tunnel. That's no good! We want vde<em>switch to connect to tap0, and for QEMU guests to connect to vde</em>switch.</p>\n<p>Don't forget:</p>\n<p>mknod /dev/kqemu c 250 0</p>\n<p>chmod 666 /dev/kqemu</p>\n<p>Here's some updated <a href=\"http://www.docunext.com/2007/07/qemu-notes/\">QEMU notes</a>:<ol><li>vde_switch -tap tap0 -daemon</li><li>ifconfig tap0 up</li><li>brctl addif br0 tap0</li><li>sudo vdeqemu -m 512 -vnc :2 -net nic,macaddr=00:11:22:ee:ff:44 -net vde deb4vde.raw &#x26;</li></ol></p>\n<p>NOTE: You will have to come up with unique mac addresses for each virtual machine you attach to the vde switch!</p>\n<p>Here is a new entry on the network when I do an nmap scan:</p>\n<pre>Host 192.168.0.188 appears to be up.\nMAC Address: 52:54:00:12:34:56 (QEMU virtual NIC)</pre>\n<p>Also, I still need to put the follow in /etc/qemu-ifup:</p>\n<pre>#!/bin/sh\necho \"Executing /etc/qemu-ifup\"\necho \"Bringing up $1 for bridged mode...\"\nsudo /sbin/ifconfig $1 0.0.0.0 promisc up\necho \"Adding $1 to br0...\"\nsudo /usr/sbin/brctl addif br0 $1\nsleep 2</pre>\n<p>On FreeBSD:\nkldload if_bridge\nifconfig bridge create\nifconfig bridge0 addm sis0 addm tap0 up</p>\n<pre>vdeqemu -vnc :1 -net nic,macaddr=12:43:12:12:23:32 -net nic,vlan=3 \\ -net vde /usr/jail/root/m0n0jab/work/image.bin</pre>\n<p>Make sure to use the VLAN tag otherwise you'll get some serious broadcast storms.</p>\n<p>Related:</p>\n<p><a href=\"http://lists.debian.org/debian-user/2006/01/msg01598.html\">http://lists.debian.org/debian-user/2006/01/msg01598.html</a></p>\n<p><a href=\"http://compsoc.dur.ac.uk/~djw/qemu.html\">http://compsoc.dur.ac.uk/~djw/qemu.html QEMU - Debian - Linux - TUN/TAP - network bridge</a></p>","fields":{"slug":"/2007/07/qemu-vde-notes-revisited/"},"frontmatter":{"title":"QEMU vde Notes Revisited","date":"July 10th, 2007","tags":"debian,freebsd,kqemu,qemu,tap,tun,vde"}}},"pageContext":{"slug":"/2007/07/qemu-vde-notes-revisited/"}}}