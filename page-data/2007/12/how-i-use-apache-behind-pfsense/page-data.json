{"componentChunkName":"component---src-templates-blog-post-js","path":"/2007/12/how-i-use-apache-behind-pfsense/","result":{"data":{"site":{"siteMetadata":{"domain":"https://www.docunext.com"}},"markdownRemark":{"html":"<p>Apache can sometimes cause problems when configured certain ways in certain environments with certain clients.</p>\n<p>Like FIN<em>WAIT</em>2.</p>\n<p>If you setup Apache behind a pfSense firewall you might notice a lot of FIN<em>WAIT</em>2 states in your table. This isn't necessary, and as I understand it is caused by sloppy http clients that never send the FIN/ACK to close the tcp connection.</p>\n<p>There are a few things I've done to alleviate this issue:</p>\n<ul>\n<li>Turn off KeepAlive in Apache</li>\n<li>Reduce the tcp timeout on the Apache server using sysctl  ( I use net.ipv4.tcp<em>keepalive</em>time = 1800 )</li>\n<li>Reduce the fin timeout (I use net.ipv4.tcp<em>fin</em>timeout = 20 )</li>\n<li>Change the firewall optimization setting to aggressive (but actually I've switched it back to normal for the time being)</li>\n</ul>\n<p>The more I read about this, the more I feel its not a serious problem, unless you have several thousand FIN<em>WAIT</em>2 states. The one's I'm mostly confused about are the ones from the firewall to the server:</p>\n<pre>192.168.3.1:43147 -> 192.168.3.2:80</pre>\n<p>There are usually many of these, and I'm not sure exactly why there needs to be so many. I think it may be since I'm using the load balancer, instead of simple nat, which I think would directly use the web server's settings for keeping state.</p>\n<p>Thankfully, pfSense has the \"advanced\" option for each firewall rule. I went into the rule for port 80, and reduced the timeout for that rule to 20, though I may reduce it more.</p>\n<p><a href=\"http://blog.pfsense.org/?p=137\">http://blog.pfsense.org/?p=137</a></p>\n<p><a href=\"http://www.dba-oracle.com/oracle_tips_tuning_the_apache_server.htm\">http://www.dba-oracle.com/oracle_tips_tuning_the_apache_server.htm</a></p>\n<p><a href=\"http://www.mail-archive.com/support@pfsense.com/msg04114.html\">http://www.mail-archive.com/support@pfsense.com/msg04114.html</a></p>\n<p><a href=\"http://library.pantek.com/Mailing%20Lists/httpd.apache.org/docs/att-4974/fin_wait_2.xml\">http://library.pantek.com/Mailing%20Lists/httpd.apache.org/docs/att-4974/fin_wait_2.xml</a></p>","fields":{"slug":"/2007/12/how-i-use-apache-behind-pfsense/"},"frontmatter":{"title":"How I use Apache behind pfSense","date":"December 3rd, 2007","tags":"apache,network,pfsense"}}},"pageContext":{"slug":"/2007/12/how-i-use-apache-behind-pfsense/"}}}