{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2007/06/lvs-ipvs-fin-wait/",
    "result": {"data":{"site":{"siteMetadata":{"domain":"https://www.docunext.com"}},"markdownRemark":{"html":"<p>I setup heartbeat and ldirectord recently for use with ipvs, basically a manually configured ultramonkey.</p>\n<p>I was running into issues with the system being very very slow, when I believed it should be very very fast. I did some debugging and found lots of FIN_WAITS:</p>\n<pre>/sbin/ipvsadm -L -n --connection\nIPVS connection entries\npro expire state       source             virtual            destination\nTCP 01:58  FIN_WAIT    74.94.149.33:51617 192.168.10.235:80  192.168.10.12:80\nTCP 01:58  FIN_WAIT    74.94.149.33:51622 192.168.10.235:80  192.168.10.12:80\nTCP 01:58  FIN_WAIT    74.94.149.33:51619 192.168.10.235:80  192.168.10.12:80\nTCP 01:58  FIN_WAIT    74.94.149.33:51618 192.168.10.235:80  192.168.10.12:80\nTCP 01:58  FIN_WAIT    74.94.149.33:51621 192.168.10.235:80  192.168.10.12:80\nTCP 01:58  FIN_WAIT    74.94.149.33:51620 192.168.10.235:80  192.168.10.12:80\n</pre>\n<p>The <a href=\"http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/LVS-HOWTO.persistent_connection.html\">LVS persistence document</a> mentions lowering the expire for testing:</p>\n<pre>ipvsadm --set 5 4 0</pre>\n<p>Works fine for me, and speeds up the service. I'll keep monitoring for unwanted side effects. For updating Wordpress posts, the process required more time. Here's what I'm using now:</p>\n<pre>ipvsadm --set 60 10 2</pre>\n<p>Related info:</p>\n<p><a href=\"http://readlist.com/lists/linuxvirtualserver.org/lvs-users/0/4799.html\">This link seems to suggest problem is caused by MTU</a></p>\n<p><a href=\"http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/LVS-HOWTO.weird_hardware.html\">This link has several LVS related switch hardware issues (Cisco)</a></p>\n<p><a href=\"http://www.vs.inf.ethz.ch/edu/WS0102/VS/TCP-State-Diagram.html%22\"><a href=\"http://www.vs.inf.ethz.ch/edu/WS0102/VS/TCP-State-Diagram.html\">http://www.vs.inf.ethz.ch/edu/WS0102/VS/TCP-State-Diagram.html</a></a></p>\n<p><a href=\"http://blog.pfsense.org/?p=137\"><a href=\"http://blog.pfsense.org/?p=137\">http://blog.pfsense.org/?p=137</a></a></p>\n<p><a href=\"http://www.docunext.com/2007/06/lvs-ipvs-fin-wait/\">How I use Apache behind pfSense (including FIN_WAIT gotchas)</a></p>\n<p>Â¥</p>","fields":{"slug":"/2007/06/lvs-ipvs-fin-wait/"},"frontmatter":{"title":"LVS ipvs FIN WAIT","date":"June 25th, 2007","tags":"pfsense,tcp"}}},"pageContext":{"slug":"/2007/06/lvs-ipvs-fin-wait/"}},
    "staticQueryHashes": ["3159585216","758480095"]}