{"componentChunkName":"component---src-templates-blog-post-js","path":"/2011/07/single-table-inheritance-and-rails-3/","result":{"data":{"site":{"siteMetadata":{"domain":"https://www.docunext.com"}},"markdownRemark":{"html":"<p>In working on Regdel, an open source bookkeeping system I am writing with Ruby on Rails, I pondered the question about whether to use Single Table Inheritance (STI), an abstract base class, a model namespace, and/or polymorphic associations for the top-level account types: assets, liabilities, equity, revenue, and expenses.</p>\n<p>Its really quite a tough call! I want all the accounts to be in one table, i.e. the chart of accounts, and I also want scoped routes to select accounts of each type. For example, a request to \"/accounts\" would return all the accounts, and a request to \"/assets\" would only return assets.</p>\n<p>I have it working, and I want to review the configuration so that I am certain it is right for this problem domain.</p>\n<p>Remember, this is Rails 3.1!</p>\n<p>First, the Account class:</p>\n<pre class=\"ruby\">\nclass Account < ActiveRecord::Base\n  include AccountMethods\n\n  ACCOUNT_TYPES = [\"Asset\", \"Liability\", \"Equity\", \"Revenue\", \"Expense\"]\n\n  serialize :attrs\n\n  validates :name,\n            :presence => true,\n            :uniqueness => true\n\n  has_many :entries\n  has_many :entry_amounts, :through => :entries\n\n  acts_as_nested_set\n\n  state_machine :initial => :active do\n\n  end\n\nend\n</pre>\n<p>Now here's the Asset class:</p>\n<pre class=\"sh_ruby\">\nclass Asset < Account\nend\n</pre>\n<p>Basic, right? So this is using STI just fine - the table has a type column which sets Asset when a new Asset is created.</p>\n<p>So how about the routes and views? Can we inherit there? Yes, with some help from InheritedResources!</p>\n<p>Here is the AccountsController:</p>\n<pre class=\"sh_ruby\">\nclass AccountsController < InheritedResources::Base\n  defaults :resource_class => Account, :collection_name => 'accounts', :instance_name => 'account'\n\n  def show\n    @account = Account.find(params[:id])\n    @sub_accounts = Account.find_all_by_parent_id(params[:id])\n  end\n\nend\n</pre>\n<p>and the AssetsController:</p>\n<pre class=\"sh_ruby\">\nclass AssetsController < AccountsController\n  defaults :resource_class => Asset, :collection_name => 'accounts', :instance_name => 'account'\nend\n</pre>\n<p>Since these are separate controllers, routes.rb needs resources for each:</p>\n<pre class=\"sh_ruby\">\n  resources :accounts do\n    resources :entries\n  end\n  resources :bank_accounts\n  resources :assets\n</pre>\n<p>At this point, we might expect that assets have their own views, and usually they need their own, but thanks to the fact that Rails 3.1 has inherited views built in, the controllers that inherit from the accounts controller share the same views!</p>\n<p>Thanks to <strong>Inherited Resources</strong>, the views use <tt>resource</tt> and <tt>resources</tt> to access the instance objects, so it greatly simplifies the controllers, too.</p>\n<p>For entries, I did something a little different, mainly because I only want new objects to have specific routes, but the rest of the restful actions to share the same controller actions. More specifically, although checks, transfers, invoices, and deposits are all subclasses of entries, they need to be typed upon instantiation for the new action form.</p>\n<p>Here's the routes I have for this:</p>\n<pre class=\"sh_ruby\">\n  resources :entries do\n    collection do\n      get 'write_check'\n      get 'transfer_funds'\n    end\n  end\n</pre>\n<h4>Links</h4>\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/598177/layer-supertype-in-activerecord-rails\">http://stackoverflow.com/questions/598177/layer-supertype-in-activerecord-rails</a></li>\n<li><a href=\"http://www.ruby-forum.com/topic/159894\">http://www.ruby-forum.com/topic/159894</a></li>\n<li><a href=\"http://api.rubyonrails.org/classes/ActiveRecord/Base.html\">http://api.rubyonrails.org/classes/ActiveRecord/Base.html</a></li>\n<li><a href=\"http://code.alexreisner.com/articles/single-table-inheritance-in-rails.html\">http://code.alexreisner.com/articles/single-table-inheritance-in-rails.html</a></li>\n<li><a href=\"https://gist.github.com/44525\">https://gist.github.com/44525</a></li>\n<li><a href=\"http://www.strictlyuntyped.com/2008/06/rails-where-to-put-other-files.html\">http://www.strictlyuntyped.com/2008/06/rails-where-to-put-other-files.html</a></li>\n</ul>","fields":{"slug":"/2011/07/single-table-inheritance-and-rails-3/"},"frontmatter":{"title":"Single Table Inheritance Inherited Resources Inherited Views and Rails 3","date":"July 2nd, 2011","tags":"ruby on rails"}}},"pageContext":{"slug":"/2011/07/single-table-inheritance-and-rails-3/"}},"staticQueryHashes":["3159585216","3388129809"]}