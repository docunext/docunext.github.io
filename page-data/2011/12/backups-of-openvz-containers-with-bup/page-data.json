{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2011/12/backups-of-openvz-containers-with-bup/",
    "result": {"data":{"site":{"siteMetadata":{"domain":"https://www.docunext.com"}},"markdownRemark":{"html":"<p>I'm planning to use bup to make backups of vzdumps. Bup is a backup utility that build on top of git's awesomeness, so in some ways, its even <em>more</em> awesome.</p>\n<p>I've got a couple components in place:</p>\n<ul>\n<li>LVM2 snapshot powered vzdumps!</li>\n<li>An initial bup backup of one of those snapshots.</li>\n</ul>\n<pre>\nroot@svx-mm-101:~# vzdump --dumpdir /root/vzsnaps --stdexcludes --compress  --snapshot 1123\nINFO: starting new backup job: vzdump --dumpdir /root/vzsnaps --stdexcludes --compress --snapshot 1123\nINFO: Starting Backup of VM 1123 (openvz)\nINFO: CTID 1123 exist mounted running\nINFO: status = CTID 1123 exist mounted running\nINFO: backup mode: snapshot\nINFO: bandwidth limit: 10240 KB/s\nINFO: creating lvm snapshot of /dev/mapper/vgone-lvone ('/dev/vgone/vzsnap-svx-mm-101.savonix.vpn-0')\nINFO:   Logical volume \"vzsnap-svx-mm-101.savonix.vpn-0\" created\nINFO: creating archive '/root/vzsnaps/vzdump-openvz-1123-2011_12_20-21_53_10.tgz'\nINFO: Total bytes written: 1595801600 (1.5GiB, 3.4MiB/s)\nINFO: archive file size: 636MB\nINFO:   Logical volume \"vzsnap-svx-mm-101.savonix.vpn-0\" successfully removed\nINFO: Finished Backup of VM 1123 (00:12:31)\nINFO: Backup job finished successfuly\n</pre>\n<pre>\nroot@svx-mm-101:/mnt/sdb1# ls -lah /mnt/sdb1/bup/\ntotal 40K\ndrwxr-xr-x  7 root root 4.0K Dec 20 22:16 .\ndrwxrwxrwx 12 root root 4.0K Dec 20 22:16 ..\ndrwxr-xr-x  2 root root 4.0K Dec 20 22:16 branches\n-rw-r--r--  1 root root   91 Dec 20 22:16 config\n-rw-r--r--  1 root root   73 Dec 20 22:16 description\n-rw-r--r--  1 root root   23 Dec 20 22:16 HEAD\ndrwxr-xr-x  2 root root 4.0K Dec 20 22:16 hooks\ndrwxr-xr-x  2 root root 4.0K Dec 20 22:16 info\ndrwxr-xr-x  4 root root 4.0K Dec 20 22:20 objects\ndrwxr-xr-x  4 root root 4.0K Dec 20 22:16 refs\nroot@svx-mm-101:/mnt/sdb1# du -sh !$\ndu -sh /mnt/sdb1/bup/\n492M  /mnt/sdb1/bup/\n</pre>\n<p>Wow - bup compressed the file another ~ 200 Mb!</p>\n<h4>What's Next?</h4>\n<p>Make another backup (only some minor changes), so I'm curious how much additional space backing up this tar file takes.</p>\n<pre>\nroot@svx-mm-101:~# vzdump --dumpdir /root/vzsnaps --stdexcludes --compress  --snapshot 1123\nINFO: starting new backup job: vzdump --dumpdir /root/vzsnaps --stdexcludes --compress --snapshot 1123\nINFO: Starting Backup of VM 1123 (openvz)\nINFO: CTID 1123 exist mounted running\nINFO: status = CTID 1123 exist mounted running\nINFO: backup mode: snapshot\nINFO: bandwidth limit: 10240 KB/s\nINFO: creating lvm snapshot of /dev/mapper/vgone-lvone ('/dev/vgone/vzsnap-svx-mm-101.savonix.vpn-0')\nINFO:   Logical volume \"vzsnap-svx-mm-101.savonix.vpn-0\" created\nINFO: creating archive '/root/vzsnaps/vzdump-openvz-1123-2011_12_20-22_21_17.tgz'\n</pre>\n<p>Well, I'm sold:</p>\n<pre>\nroot@svx-mm-101:/mnt/sdb1# bup split -n vzdump-openvz-1123  vzdumps/vzdump-openvz-1123.tgz\nPackIdxList: using 1 index.\nIndexing objects: 100% (3626/3626), done.\nroot@svx-mm-101:/mnt/sdb1# du -sh bup/\n520M  bup/\n</pre>\n<p>So it only took about 8MB more memory to backup a different version of a ~600MB compressed tarfile. Sweet.</p>\n<p>I restored the file and compared checksums of the backup and the original and they matched up - yay!</p>\n<h4>Now What's Next?</h4>\n<p>I plan to automate all this; it will take a bit of shell script writing, but shouldn't be a big deal.</p>\n<p>This is not very impressive, but its a start:</p>\n<pre>\nls -1 vzdumps | awk '{print \"bup split -n \"$1\"z vzdumps/\"$1}' | sed \"s/\\.tgzz//g\"\n</pre>\n<pre>\ndocunext@vpn-comet:~/vzsnaps$ git annex move vzdump-openvz-230131.tgz --to svxbup\nmove vzdump-openvz-230131.tgz (checking svxbup...) (to svxbup...)\nReceiving index from server: 1848232/1848232, done.\nReceiving index from server: 960744/960744, done.\nbloom: creating from 2 files (100244 objects).\nReceiving index from server: 981968/981968, done.\nbloom: adding 1 file (35032 objects).\nReceiving index from server: 852132/852132, done.\nbloom: adding 1 file (30395 objects).\nInitialized empty Git repository in /home/albertlash/.bup/\nbloom: creating from 14 files (696899 objects).\nReceiving index from server: 885928/885928, done.\nbloom: adding 1 file (31602 objects).\nok\n</pre>","fields":{"slug":"/2011/12/backups-of-openvz-containers-with-bup/"},"frontmatter":{"title":"Backups of OpenVZ Containers with bup","date":"December 20th, 2011","tags":"backups,bup,lvm,openvz"}}},"pageContext":{"slug":"/2011/12/backups-of-openvz-containers-with-bup/"}},
    "staticQueryHashes": ["3159585216","758480095"]}