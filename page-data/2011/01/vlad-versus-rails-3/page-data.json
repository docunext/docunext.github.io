{"componentChunkName":"component---src-templates-blog-post-js","path":"/2011/01/vlad-versus-rails-3/","result":{"data":{"markdownRemark":{"html":"<p>It appears there is some sort of problem that I am having trying to use Vlad with Rails 3.</p>\n<p>Could it be bundler?</p>\n<pre class=\"sh_sh\">\nrake aborted!\nundefined method `remote_task' for #<Object:0xb7864950 @application=\"app.com\">\n/home/example/operations/dev/app.com/Rakefile:7\n(See full trace by running task with --trace)\n</pre>\n<p>I'm also getting this error:</p>\n<pre class=\"sh_sh\">\nrake aborted!\nPlease specify the server domain via the :domain variable\n(See full trace by running task with --trace)\n</pre>\n<p>And yes, I do have vlad-git installed....</p>\n<p>I wonder what is wrong?</p>\n<h4>UPDATE:</h4>\n<p>I'm still having major issues with this, and it appears that the source of the problem is changes in Vlad's use of deploy.rb versus changes in Rake's use of lib/tasks/.</p>\n<p>ARGH!</p>\n<p>Anyway, I have made some progress, and am stumped when running <tt>vlad:setup</tt>:</p>\n<pre class=\"sh_sh\">\nundefined method `[]' for nil:NilClass\n</pre>\n<p>Yay! I think I figured it out. For some reason, I was using \"remote_task\" instead of \"rake-remote_task\". Grrr.</p>\n<p>And for what its worth, my current config/deploy.rb looks similar to this:</p>\n<pre class=\"sh_ruby\">\nset :myapp, \"example.com\"\nset :deploy_to, \"/var/www/dev/#{myapp}.com\"\nset :domain, \"pro-103-gl.example.com\"\nset :repository, \"git@github.com:user/example.com.git\"\n</pre>\n<p>And my lib/tasks/vlad.rake file looks similar to this:</p>\n<pre class=\"sh_ruby\">\nbegin\n  require 'vlad'\n  Vlad.load :scm => :git\nrescue\n # do nothing\nend\nnamespace :vlad do\n  remote_task :mkdaemon do\n    run \"mkdir -p /tmp/#{myapp}/log\"\n    run \"echo '#!/bin/sh' > /tmp/#{myapp}/run\"\n    run \"echo 'exec /var/www/dev/#{myapp}/current/demo.sh' >> /tmp/#{myapp}/run\"\n    run \"echo '#!/bin/sh' > /tmp/#{myapp}/log/run\"\n    run \"echo 'exec setuidgid daemon multilog t ./main' >> /tmp/#{myapp}/log/run\"\n    run \"sudo chown -R root:root /tmp/#{myapp}\"\n    run \"sudo chmod +x /tmp/#{myapp}/run\"\n    run \"sudo chmod +x /tmp/#{myapp}/log/run\"\n    run \"sudo mv /tmp/#{myapp} /service/\"\n  end\n  remote_task :bundle do\n    run \"cd /var/www/dev/#{myapp}/current/ && bundle install &\"\n  end\n  remote_task :restart do\n    run \"sudo svc -d /service/#{myapp}\"\n    run \"sudo svc -u /service/#{myapp}\"\n  end\n  remote_task :fix do\n    run \"mkdir -p /var/www/dev/#{myapp}/current/public/d/xhtml\"\n    run \"chmod 0777 /var/www/dev/#{myapp}/current/public/d/xhtml\"\n  end\n  remote_task :logtail do\n    run \"tail /tmp/webapps/#{myapp}.log -n 100\"\n  end\n  task :deploy => [:update, :restart, :fix]\nend\n</pre>","frontmatter":{"title":"Vlad versus Rails 3","date":"January 23rd, 2011"}}},"pageContext":{"slug":"/2011/01/vlad-versus-rails-3/"}}}