{"componentChunkName":"component---src-templates-blog-post-js","path":"/2013/02/ip-packet-with-unknown-ip-version-15-seen/","result":{"data":{"site":{"siteMetadata":{"domain":"https://www.docunext.com"}},"markdownRemark":{"html":"<p>After deciding to simplify my linode VM, I gave my LXC setup, however so\nincredibly cool, the end-of-life notice. The routing was a pain, and I decided\nto save some memory^1 and go with the stock linode kernel to benefit from their\nsupport. Using pv_grub was cool, but linode won't support it.</p>\n<p>After switching kernels, I ran into a few glitches:</p>\n<ul>\n<li>Firehol kept squaking at me about ip_conntrack (the stock linode kernel\nhas its modules built-in, not modprobed), so I switched to ufw, which\nI greatly prefer, so that ended up being a bonus.</li>\n<li>OpenVPN started acting wacky. Granted, my setup was wacky, but I was surprised\nhow opaque the error message I found, and how little subsequent searches\nturned up.</li>\n</ul>\n<h4>IP packet with unknown IP version=15 seen</h4>\n<p>Interesting error message, eh? Almost as good as treason uncloaked!\nSearches turned up some recommendations to ensure matching tuns or taps on the\nclient and server, as well as ensuring matching lzo compression settings - all\nthat is standard requirements for OpenVPN, and they weren't my issue.</p>\n<p>Ack! I was just about to elaborate on the changes I took to render that error\nbegone when it reared its ugly head once more. The horror!</p>\n<p>I avoid rebooting if I can, but I've thrown in the towel and decided to do it.\nI've changed so much with sticky bits like netfilter rules that I've decided to\njust do it.</p>\n<p>...5 minutes go by, elevator music playing...</p>\n<p>Its still occurring; and although I found a rougue client setup that I forgot\nabout that was trying to connect without lzo, I disabled it, and the error\ncontinues.</p>\n<p>Tcpdump reveals this funny bit:</p>\n<pre><code>21:08:56.542726 f2:3c:91:ae:13:53 > ff:ff:ff:ff:ff:ff, ethertype Unknown\n(0x88a2), length 32:\n  0x0000:  1000 ffff ff01 0000 0000 0000 0000 0000  ................\n  0x0010:  0000         \n</code></pre>\n<p>Turning on ipv6 clears that up:</p>\n<pre><code>21:26:49.553612 IP6 fe80::1 > ff02::1: ICMP6, router advertisement, length 64\n</code></pre>\n<p>but still doesn't explain why I'm still getting that IP packet with unknown IP\nversion=15 seen message.</p>\n<p>Hmm. No, still getting that error about the ethertype Unknown.</p>\n<p>Here's something; the ICMP6 broadcast is legit, but the 0x88a2 broadcast is\nfishy. Check out this thread from <a href=\"http://forums.gentoo.org/viewtopic-t-945874.html\">gentoo</a>. They suggest its\na some device announcing itself to the world. Wonderful! Since its\na broadcast, the nature of the tun device receives it too, so I'm trying out the\nsolution they suggest to use ebtables.</p>\n<pre><code>-A FORWARD -p 0x88a2 -j DROP\n</code></pre>\n<p>didn't do it, so I'm trying:</p>\n<pre><code>-A INPUT -p 0x88a2 -j DROP\n</code></pre>\n<p>as well.</p>\n<p>Not there yet, now trying:</p>\n<pre><code>ebtables -A INPUT -s f2:3c:91:ae:13:53/ff:ff:ff:ff:ff:ff -j DROP\nebtables -A FORWARD -s f2:3c:91:ae:13:53/ff:ff:ff:ff:ff:ff -j DROP\n</code></pre>\n<p>Hey what do you know - f2:3c:91:ae:13:53 is my MAC addr. Its probably something\nto do with the hardware platform that linode is using, that may use AoE.</p>\n<p>I'm just going to dial down the verbosity of OpenVPN until it becomes an issue.\nArgh, that didn't work either, and I couldn't give it up; so decided to switch\nback to the Ubuntu stock kernel. That seems to have fixed all sorts of\nannoyances. I'm pretty certain that unknown ethertype was AoE, the module being\ncompiled into the linode kernel.</p>\n<pre><code>aoe: AoE v50 initialised.\n</code></pre>\n<p>I suspect that was the culprit of the unknown ethertype, but I'm still not sure\nabout the original oddity; the IP packet with unknown IP version=15 seen log.\nThat's thankfully gone away, it could have been something missing from the\nlinode kernel, or it could have been one of the new rules I've setup with ufw.</p>\n<p>Ufw rocks; I dig it.</p>\n<p>^1 - I am not sure if using the stock linode kernel or the stock ubuntu kernel\nwill be more memory efficient, could be the latter, as only the necessary\nmodules will get loaded in. Its a theory.</p>","fields":{"slug":"/2013/02/ip-packet-with-unknown-ip-version-15-seen/"},"frontmatter":{"title":"IP packet with unknown IP version 15 seen","date":"February 9th, 2013","tags":"openvpn, errors, linode"}}},"pageContext":{"slug":"/2013/02/ip-packet-with-unknown-ip-version-15-seen/"}}}