{"componentChunkName":"component---src-templates-blog-post-js","path":"/2010/03/converting-memcachedb-posts-to-mongodb/","result":{"data":{"site":{"siteMetadata":{"domain":"https://www.docunext.com"}},"markdownRemark":{"html":"<p>This probably won't make much sense out of context, but I wanted to make note of this anyway.</p>\n<p>I started work on a little blog engine to learn more about NoSQL, more specifically, publishing with MemcacheDB. I later decided I wanted to use MongoDB. To migrate the old posts to the new storage backend, I wrote this little convert function within my Sinatra App to do so:</p>\n<pre class=\"sh_ruby\">\n    # Temp func to convert memc posts to new mongodb posts\n    get '/news/convert' do\n      coll = Dlabzapp1.runtime['mgdb'].collection('entries')\n      @rawst = Dlabzapp1.memcdb.get('index');\n      index = JSON.parse(@rawst)\n      index.each_pair do |key,value|\n        cnt = Dlabzapp1.memcdb.get(value).to_s\n        coll.insert({\n          :rurl => value,\n          :entry_title => cnt.gsub(/\\n\\n.+/,''),\n          :entry_text => cnt.gsub(/^[^\\n]+\\n\\n/,''),\n          :created_on => Time.now.to_i\n        })\n      end\n    end\n</pre>\n<p>Then once I confirmed they had been migrated, I deleted them:</p>\n<pre class=\"sh_ruby\">\n    # Temp func to delete memc posts to new mongodb posts\n    get '/news/delete' do\n      @rawst = Dlabzapp1.memcdb.get('index');\n      index = JSON.parse(@rawst)\n      result = \"\"\n      index.each_pair do |key,value|\n        if Dlabzapp1.memcdb.get(value)\n          Dlabzapp1.memcdb.delete(value)\n          result << \"#{value} has been deleted\\n\"\n        end\n      end\n      result\n    end\n</pre>\n<p>I ran this twice. First it reported that the entries had been deleted. Then it reported nothing, as the entries were not found. Then I ran this to delete the index:</p>\n<pre class=\"sh_ruby\">\n    # Temp func to delete memc post index to new mongodb posts\n    get '/news/delindex' do\n      @rawst = Dlabzapp1.memcdb.delete('index');\n      \"ok\"\n    end\n</pre>\n<p>Â¥</p>","fields":{"slug":"/2010/03/converting-memcachedb-posts-to-mongodb/"},"frontmatter":{"title":"Converting MemcacheDB Posts to MongoDB","date":"March 1st, 2010","tags":"mongodb,sinatra"}}},"pageContext":{"slug":"/2010/03/converting-memcachedb-posts-to-mongodb/"}},"staticQueryHashes":["3159585216","3388129809"]}