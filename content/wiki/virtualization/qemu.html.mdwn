In a nutshell, QEMU rules.  It is a userland software application which
provides comprehensive hardware emulation. To be specific, it provides the
ability to run one operating system within another.

### QEMU with VDE2 on Debian
The following are the steps I use to get a good qemu setup on a [[/debian]]
machine, designed for running multiple instances of qemu with kqemu and
networking them together with vde.

### Install Everything

    sudo aptitude install kqemu-common kqemu-source module-assistant qemu vde2

#### KQEMU

* <http://www.docunext.com/blog/2007/09/installing-kqemu-on-debian-with-module-assistant.html>

### Configuration

/etc/networking/interfaces

~~~
auto br0
iface br0 inet dhcp
        bridge_ports eth0
        bridge_maxwait 2
        #kvm has to have this set to 0.0.0.0 to work... not sure why
        #not sure if promisc is necessary
        up /sbin/ifconfig eth0 inet 0.0.0.0

#set to something random, br0 initialization will undo this
iface eth0 inet static
        address 172.16.5.0
        netmask 255.255.255.0
~~~

/etc/qemu-ifup

~~~
#!/bin/sh

echo "Executing /etc/qemu-ifup"
echo "Bringing up $1 for bridged mode..."
sudo /sbin/ifconfig $1 0.0.0.0 promisc up
echo "Adding $1 to br0..."
sudo /usr/sbin/brctl addif br0 $1
sleep 2
~~~

#### Start Your Engines
~~~
modprobe kqemu
vde_switch -tap tap0 -daemon
ifconfig tap0 up
brctl addif br0 tap0
~~~
