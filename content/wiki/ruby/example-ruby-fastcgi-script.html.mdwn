Here is an example [[Ruby]] script that uses the [[FastCGI]] library (it also leverages [[Memcache]]):

<pre class="sh_ruby">

#!/usr/bin/ruby1.8
require 'memcache'
require 'fcgi'

mycache = MemCache.new '192.168.8.2:21201', :namespace => 'pagepop'

FCGI.each_cgi {|cgi|

    url = String.new("")
    # To test via the command line:
    # echo "test_3i9u=true" | ./pagepop.fcgi
    # To clear the tests
    # echo "test_3i9u=delete" | ./pagepop.fcgi

    if cgi["test_3i9u"].length > 0
        url = 'test_3i9u'
        if cgi["test_3i9u"] == 'delete'
            mycache.delete(url)
        end
        myvotes = mycache.incr(url,1)
    else
        url = cgi.env_table["HTTP_REFERER"]
        url.sub!("http://","")
    end

    if cgi.env_table["REQUEST_METHOD"] == "POST"
        myvotes = mycache.incr(url,1)
    else
        begin
            myvotes = mycache.get(url)
        rescue
            myvotes = mycache.incr(url,0)
        end
    end

    puts cgi.header("text/plain")
    if myvotes
        puts myvotes
    else
        myvotes = mycache.set(url,1)
        puts myvotes
    end

}
</pre>

